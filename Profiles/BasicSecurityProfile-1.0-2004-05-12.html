<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Basic Security Profile - Version 1.0 (WGD)</title>
    <style type="text/css">
		       body { color: black; background: white; font-family: sans-serif; margin: 16pt 24pt; }
		       dt { font-style: italic; padding-top: 0.5em; }
		       .refinement { margin: 18pt 0em; }
		     h4 { font-weight: normal; font-style: italic; font-size: 0.8em; margin-bottom: 0; }
			.statement { font-style: italic; margin: 0.5em 5.5em; text-indent: -4em; }
			.statement-id { background-color: #ffa; font-style: normal; padding: 0em 0.3em; }
			.statement-type { background-color: #ccf; font-style: normal; padding: 0em 0.3em; font-size: 0.7em; vertical-align: text-top; }
			.statement-origin { background-color: #fcc; font-style: normal; padding: 0em 0.3em; font-size: 0.7em; vertical-align: text-top; }
			.rationale { margin: 0.5em 0em;  }
			.explanation { margin: 0.5em 0em; }
			.definition { margin: 0.5em 5.5em;}
			.explanation p, .rationale p { margin: 0.25em 0; }
			.practice { background-color: green; }
			.example { background-color: #eee; margin: 0.5em 2em; padding: 0.5em; }
			.example-banner { margin: 0; }
			.example pre { margin: 0; }
			.correct, .incorrect { font-family: sans-serif; font-weight: bold; font-size: 0.9em; margin: 0; }
			.correct { color: #090; }
			.incorrect { color: #900; }
			.specification { padding: 0.5em; background-color: #ffa; margin: 0.5em 2em; }
			.ednote { margin: 1.2em; padding: 1.2em; background-color: #fee; }
			.note { background-color: #fcc; margin-left: 1.5em; }
			.toc { margin-left: 2em; }
			.subtoc { margin-left: 3em; }
			.subsubtoc { margin-left: 4em; }
			@media print {
  				a.offsite:after {
    					content: " &lt;" attr(href) "&gt; ";
    					font-size: 85%;
    					font-weight: lighter;
  				}
			} 
			.chg { background-color: orange; text-decoration: underline; }
			.add { background-color: green; text-decoration: underline; }
			.del { background-color: red; text-decoration: line-through; }
		</style>
  </head>
  <body>
    <div class="head">
      <p>
        <a href="http://www.ws-i.org/">
          <img src="http://www.ws-i.org/images/WS-I-logo.gif" height="88" width="107" border="0" alt="WS-I" />
        </a>
      </p>
      <h1>Basic Security Profile Version 1.0</h1>
      <h2>Working Group Draft</h2>
      <h2>Date: 2004/05/12 10:20:46 </h2>
      <dl>
        <dt>This version:</dt>
        <dd>
          <a href="http://www.ws-i.org/Profiles/BasicSecurityProfile-1.0-2004-05-12.html">http://www.ws-i.org/Profiles/BasicSecurityProfile-1.0-2004-05-12.html
							</a>
        </dd>
        <dt>Latest version:</dt>
        <dd>
          <a href="http://www.ws-i.org/Profiles/BasicSecurityProfile-1.0.html">http://www.ws-i.org/Profiles/BasicSecurityProfile-1.0.html
							</a>
        </dd>
        <dt>Editors:</dt>
        <dd>Abbie Barbir, Nortel Networks</dd>
        <dd>Martin Gudgin, Microsoft</dd>
        <dd>Michael McIntosh, IBM</dd>
        <dt>Administrative contact:</dt>
        <dd>
          <a href="mailto:secretary@ws-i.org">secretary@ws-i.org</a>
        </dd>
      </dl>
      <p class="copyright" id="copyright"> Copyright &#169;  2002-2004 by
			<a href="http://www.ws-i.org/">The Web Services-Interoperability
			Organization</a> (<abbr title="Web Services Interoperability&#xD;&#xA;			Organization">WS-I</abbr>) and Certain of its Members. All Rights
			Reserved.</p>
    </div>
    <hr />
    <h2 id="abstract">Abstract</h2>
    <p>This document defines the WS-I Basic Security Profile 1.0, consisting of a set of non-proprietary Web services specifications, 
        along with clarifications and amendments to those specifications which promote interoperability.</p>
    <h2 id="status">Status of this Document</h2>
    <p> This document is a Working
				Group Draft; it has been accepted by the Working Group as
				reflecting the current state of discussions. It is a work in
				progress, and should not be considered authoritative or final;
				other documents may supersede this document. </p>
    <h2 id="license">Notice</h2>
    <p>The material contained herein is not a license, either expressly or impliedly, to any intellectual property owned or controlled by any of the authors or developers of this material or WS-I. The material contained herein is provided on an "AS IS" basis and to the maximum extent permitted by applicable law, this material is provided AS IS AND WITH ALL FAULTS, and the authors and developers of this material and WS-I hereby disclaim all other warranties and conditions, either express, implied or statutory, including, but not limited to, any (if any) implied warranties, duties or conditions of merchantability, of fitness for a particular purpose, of accuracy or completeness of responses, of results, of workmanlike effort, of lack of viruses, and of lack of negligence. ALSO, THERE IS NO WARRANTY OR CONDITION OF TITLE, QUIET ENJOYMENT, QUIET POSSESSION, CORRESPONDENCE TO DESCRIPTION OR NON-INFRINGEMENT WITH REGARD TO THIS MATERIAL. </p>
    <p>IN NO EVENT WILL ANY AUTHOR OR DEVELOPER OF THIS MATERIAL OR WS-I BE LIABLE TO ANY OTHER PARTY FOR THE COST OF PROCURING SUBSTITUTE GOODS OR SERVICES, LOST PROFITS, LOSS OF USE, LOSS OF DATA, OR ANY INCIDENTAL, CONSEQUENTIAL, DIRECT, INDIRECT, OR SPECIAL DAMAGES WHETHER UNDER CONTRACT, TORT, WARRANTY, OR OTHERWISE, ARISING IN ANY WAY OUT OF THIS OR ANY OTHER AGREEMENT RELATING TO THIS MATERIAL, WHETHER OR NOT SUCH PARTY HAD ADVANCE NOTICE OF THE POSSIBILITY OF SUCH DAMAGES.</p>
    <h2 id="feedback">Feedback</h2>
    <p>The Web Services-Interoperability Organization (WS-I)
					would like to receive input, suggestions and other
					feedback ("Feedback") on this work from a wide variety of
					industry participants to improve its quality over time.
					</p>
    <p>By sending email, or otherwise communicating with
			WS-I, you (on behalf of yourself if you are an
			individual, and your company if you are providing
			Feedback on behalf of the company) will be deemed to
			have granted to WS-I, the members of WS-I, and other
			parties that have access to your Feedback, a
			non-exclusive, non-transferable, worldwide, perpetual,
			irrevocable, royalty-free license to use, disclose,
			copy, license, modify, sublicense or otherwise
			distribute and exploit in any manner whatsoever the
			Feedback you provide regarding the work. You acknowledge
			that you have no expectation of confidentiality with
			respect to any Feedback you provide. You represent and
			warrant that you have rights to provide this Feedback,
			and if you are providing Feedback on behalf of a
			company, you represent and warrant that you have the
			rights to provide Feedback on behalf of your company.
			You also acknowledge that WS-I is not required to
			review, discuss, use, consider or in any way incorporate
			your Feedback into future versions of its work. If WS-I
			does incorporate some or all of your Feedback in a
			future version of the work, it may, but is not obligated
			to include your name (or, if you are identified as
			acting on behalf of your company, the name of your
			company) on a list of contributors to the work. If the
			foregoing is not acceptable to you and any company on
			whose behalf you are acting, please do not provide any
			Feedback.</p>
    <p>Feedback on this document should be directed to <a href="mailto:wsi_secprofile_comment@lists.ws-i.org">wsi_secprofile_comment@lists.ws-i.org</a>.</p>
    <hr />
    <h2 id="toc">Table of Contents</h2>
    <p class="toc">1. <a href="#introduction">Introduction</a><br /><span class="subtoc">1.1. <a href="#philosophy">Guiding Principles</a></span><br /><span class="subtoc">1.2. <a href="#conventions">Notational Conventions</a></span><br />2. <a href="#scope">Scope of the Profile</a><br />3. <a href="#conformance">Profile Conformance</a><br /><span class="subtoc">3.1. <a href="#artifacts">Conformance of Artifacts</a></span><br /><span class="subtoc">3.2. <a href="#senders">Conformance of Message Senders</a></span><br /><span class="subtoc">3.3. <a href="#receivers">Conformance of Message Receivers</a></span><br /><span class="subtoc">3.4. <a href="#claiming">Claiming Conformance</a></span><br />4. <a href="#transportsec">Transport Layer Security</a><br /><span class="subtoc">4.1. <a href="#SSLTLS">SSL and TLS</a></span><br /><span class="subsubtoc">4.1.1. <a href="#XSLTrefinement122121124121121120">Use of SSL 2.0</a></span><br /><span class="subtoc">4.2. <a href="#transportsecConsiderations">Security Considerations</a></span><br /><span class="subsubtoc">4.2.1. <a href="#XSLTrefinement122122124121121120">SOAPAction Header</a></span><br />5. <a href="#msgsec">SOAP Message Security</a><br /><span class="subtoc">5.1. <a href="#WSSST">Security Tokens</a></span><br /><span class="subsubtoc">5.1.1. <a href="#XSLTrefinement123121126121121120">Binary Security Token EncodingType Attribute</a></span><br /><span class="subsubtoc">5.1.2. <a href="#XSLTrefinement124121126121121120">Binary Security Token ValueType Attribute</a></span><br /><span class="subtoc">5.2. <a href="#WSSTokenReferences">SecurityTokenReferences</a></span><br /><span class="subsubtoc">5.2.1. <a href="#XSLTrefinement122122126121121120">Use of wsse:SecurityTokenReference</a></span><br /><span class="subsubtoc">5.2.2. <a href="#XSLTrefinement123122126121121120">Internal References</a></span><br /><span class="subsubtoc">5.2.3. <a href="#XSLTrefinement124122126121121120">Shorthand XPointer References</a></span><br /><span class="subsubtoc">5.2.4. <a href="#XSLTrefinement125122126121121120">References to Preceding Security Tokens</a></span><br /><span class="subsubtoc">5.2.5. <a href="#XSLTrefinement126122126121121120">Direct Preferred to Embedded for Internal References</a></span><br /><span class="subsubtoc">5.2.6. <a href="#XSLTrefinement127122126121121120">Direct Required When Possible for External References</a></span><br /><span class="subsubtoc">5.2.7. <a href="#XSLTrefinement128122126121121120">Format of Embedded References</a></span><br /><span class="subsubtoc">5.2.8. <a href="#XSLTrefinement129122126121121120">Key Identifier for External References</a></span><br /><span class="subsubtoc">5.2.9. <a href="#XSLTrefinement130122126121121120">Key Name References Prohibited</a></span><br /><span class="subsubtoc">5.2.10. <a href="#XSLTrefinement131122126121121120">ds:KeyInfo/wsse:SecurityTokenReference in XML Signatures</a></span><br /><span class="subsubtoc">5.2.11. <a href="#XSLTrefinement132122126121121120">ds:KeyInfo/wsse:SecurityTokenReference in XML Encryption</a></span><br /><span class="subsubtoc">5.2.12. <a href="#XSLTrefinement133122126121121120">KeyIdentifier/@ValueType Attribute</a></span><br /><span class="subsubtoc">5.2.13. <a href="#XSLTrefinement134122126121121120">Children of wsse:Embedded</a></span><br /><span class="subsubtoc">5.2.14. <a href="#XSLTrefinement135122126121121120">Reference from wsse:SecurityTokenReference to wsse:SecurityTokenReference</a></span><br /><span class="subsubtoc">5.2.15. <a href="#XSLTrefinement136122126121121120">wsse:SecurityTokenReference/Reference ValueType Attribute</a></span><br /><span class="subsubtoc">5.2.16. <a href="#XSLTrefinement137122126121121120">wsse:SecurityTokenReference constraints</a></span><br /><span class="subsubtoc">5.2.17. <a href="#XSLTrefinement138122126121121120">wsse:SecurityTokenReference Dereferencing Transform</a></span><br /><span class="subtoc">5.3. <a href="#WSSTimeStamp">Timestamps</a></span><br /><span class="subsubtoc">5.3.1. <a href="#XSLTrefinement122123126121121120">wsu:Timestamp</a></span><br /><span class="subtoc">5.4. <a href="#WSSReferences">wsu:Id References</a></span><br /><span class="subsubtoc">5.4.1. <a href="#XSLTrefinement122124126121121120">wsu:Id Attribute Uniqueness</a></span><br /><span class="subtoc">5.5. <a href="#WSSProcessing">wsse:Security Processing Order</a></span><br /><span class="subsubtoc">5.5.1. <a href="#XSLTrefinement122125126121121120">Order of Processing</a></span><br /><span class="subtoc">5.6. <a href="#WSSActor">SOAP Actor</a></span><br /><span class="subsubtoc">5.6.1. <a href="#XSLTrefinement122126126121121120">SOAP Actor Value</a></span><br />6. <a href="#usernametoken">Username Token Profile</a><br /><span class="subtoc">6.1. <a href="#tokenusage">Token Usage</a></span><br /><span class="subsubtoc">6.1.1. <a href="#XSLTrefinement120121128121121120">wsse:UsernameToken/wsse:Password/@Type</a></span><br /><span class="subsubtoc">6.1.2. <a href="#XSLTrefinement121121128121121120">PasswordDigest</a></span><br /><span class="subsubtoc">6.1.3. <a href="#XSLTrefinement122121128121121120">wsse:Nonce</a></span><br /><span class="subsubtoc">6.1.4. <a href="#XSLTrefinement123121128121121120">ValueType attribute</a></span><br /><span class="subsubtoc">6.1.5. <a href="#XSLTrefinement124121128121121120">Reference by KeyIdentifier</a></span><br /><span class="subsubtoc">6.1.6. <a href="#XSLTrefinement125121128121121120">Key Derivation</a></span><br /><span class="subsubtoc">6.1.7. <a href="#XSLTrefinement126121128121121120">Sign UsernameToken</a></span><br />7. <a href="#x509token">X.509 Certificate Token Profile</a><br /><span class="subtoc">7.1. <a href="#x509tokentypes">Token Types</a></span><br /><span class="subsubtoc">7.1.1. <a href="#XSLTrefinement122121130121121120">Certificate Path</a></span><br /><span class="subsubtoc">7.1.2. <a href="#XSLTrefinement123121130121121120">KeyIdentifier</a></span><br /><span class="subsubtoc">7.1.3. <a href="#XSLTrefinement124121130121121120">Use of SecurityTokenReference</a></span><br />8. <a href="#xmlSignature">XML-Signature</a><br /><span class="subtoc">8.1. <a href="#xmlSignatureGeneral">General Constraints on XML Signature</a></span><br /><span class="subsubtoc">8.1.1. <a href="#XSLTrefinement120122132121121120">Types of Signatures</a></span><br /><span class="subtoc">8.2. <a href="#WSSIDRef">Element References in XML Signature</a></span><br /><span class="subsubtoc">8.2.1. <a href="#XSLTrefinement122123132121121120">Reference to element with ID attribute</a></span><br /><span class="subsubtoc">8.2.2. <a href="#XSLTrefinement123123132121121120">Reference to element without ID attribute</a></span><br /><span class="subtoc">8.3. <a href="#xmlSignatureAlgorithms">XML Signature Algorithms</a></span><br /><span class="subsubtoc">8.3.1. <a href="#XSLTrefinement120124132121121120">Use Exclusive C14N</a></span><br /><span class="subsubtoc">8.3.2. <a href="#XSLTrefinement121124132121121120">Transform required</a></span><br /><span class="subsubtoc">8.3.3. <a href="#XSLTrefinement122124132121121120">Permitted algorithms</a></span><br /><span class="subtoc">8.4. <a href="#xmlSignatureSyntax">XML Signature Syntax</a></span><br /><span class="subsubtoc">8.4.1. <a href="#XSLTrefinement121125132121121120">ds:HMACOutputLength</a></span><br /><span class="subsubtoc">8.4.2. <a href="#XSLTrefinement122125132121121120">ds:KeyInfo</a></span><br /><span class="subsubtoc">8.4.3. <a href="#XSLTrefinement123125132121121120">ds:Manifest</a></span><br /><span class="subtoc">8.5. <a href="#xmlSignatureConsiderations">Security Considerations</a></span><br /><span class="subsubtoc">8.5.1. <a href="#XSLTrefinement120126132121121120">Sign Security Token</a></span><br />9. <a href="#xmlEncryption">XML Encryption</a><br /><span class="subtoc">9.1. <a href="#xmlEncryptProcessing">XML Encryption Processing Model</a></span><br /><span class="subsubtoc">9.1.1. <a href="#XSLTrefinement120122134121121120">xenc:ReferenceList</a></span><br /><span class="subsubtoc">9.1.2. <a href="#XSLTrefinement121122134121121120">xenc:EncryptedKey</a></span><br /><span class="subtoc">9.2. <a href="#xmlEncryptionKeys">XML Encryption Syntax</a></span><br /><span class="subsubtoc">9.2.1. <a href="#XSLTrefinement122123134121121120">Placement</a></span><br /><span class="subsubtoc">9.2.2. <a href="#XSLTrefinement123123134121121120">xenc:EncryptedKey attributes</a></span><br /><span class="subsubtoc">9.2.3. <a href="#XSLTrefinement124123134121121120">xenc:EncryptedData attributes</a></span><br /><span class="subsubtoc">9.2.4. <a href="#XSLTrefinement125123134121121120">References from xenc:EncryptedData</a></span><br /><span class="subsubtoc">9.2.5. <a href="#XSLTrefinement126123134121121120">xenc:EncryptionMethod mandatory</a></span><br /><span class="subsubtoc">9.2.6. <a href="#XSLTrefinement127123134121121120">xenc:EncryptedKey/@Recipient</a></span><br /><span class="subsubtoc">9.2.7. <a href="#XSLTrefinement128123134121121120">ds:KeyInfo/xenc:AgreementMethod prohibited</a></span><br /><span class="subsubtoc">9.2.8. <a href="#XSLTrefinement129123134121121120">xenc:EncryptedData</a></span><br /><span class="subsubtoc">9.2.9. <a href="#XSLTrefinement130123134121121120">SOAP Envelope</a></span><br /><span class="subtoc">9.3. <a href="#xmlEncryptionAlgorithms">XML Encryption Algorithms</a></span><br /><span class="subsubtoc">9.3.1. <a href="#XSLTrefinement120124134121121120">Permitted Algorithms</a></span><br /><span class="subtoc">9.4. <a href="#xmlEncryptionConsiderations">Security Considerations</a></span><br /><span class="subsubtoc">9.4.1. <a href="#XSLTrefinement120125134121121120">Encrypt DigestValue</a></span><br />10. <a href="#algorithms">Algorithms</a><br /><span class="subtoc">10.1. <a href="#tlssslalg">Transport Level Security Algorithms</a></span><br /><span class="subsubtoc">10.1.1. <a href="#XSLTrefinement121121136121121120">Mandatory ciphersuites</a></span><br /><span class="subsubtoc">10.1.2. <a href="#XSLTrefinement122121136121121120">Recommended ciphersuites</a></span><br /><span class="subsubtoc">10.1.3. <a href="#XSLTrefinement123121136121121120">Discouraged ciphersuites</a></span><br /><span class="subsubtoc">10.1.4. <a href="#XSLTrefinement124121136121121120">Prohibited ciphersuites</a></span><br />11. <a href="#reltoBasicProfile">Relationship of Basic Security Extension Profile to Basic Profile</a><br /><span class="subtoc">11.1. <a href="#bpclarify">Basic Profile Clarifications</a></span><br /><span class="subsubtoc">11.1.1. <a href="#XSLTrefinement121121138121121120">BP Requirement R2301</a></span><br /><span class="subsubtoc">11.1.2. <a href="#XSLTrefinement122121138121121120">BP Requirement R2710</a></span><br /><span class="subsubtoc">11.1.3. <a href="#XSLTrefinement123121138121121120">BP Requirement R2712</a></span><br /><span class="subsubtoc">11.1.4. <a href="#XSLTrefinement124121138121121120">BP Requirement R2724</a></span><br /><span class="subsubtoc">11.1.5. <a href="#XSLTrefinement125121138121121120">BP Requirement R2725</a></span><br /><span class="subsubtoc">11.1.6. <a href="#XSLTrefinement126121138121121120">BP Requirement R2729</a></span><br /><span class="subsubtoc">11.1.7. <a href="#XSLTrefinement127121138121121120">BP Requirement R2738</a></span><br />12. <a href="#attachsec">Attachment Security</a><br /><span class="subtoc">12.1. <a href="#swa">SOAP with Attachments</a></span><br /><span class="subsubtoc">12.1.1. <a href="#XSLTrefinement121121140121121120">Conformance</a></span><br /><span class="subsubtoc">12.1.2. <a href="#XSLTrefinement122121140121121120">Scope</a></span><br /><span class="subtoc">12.2. <a href="#signedAttachments">Signed Attachments</a></span><br /><span class="subsubtoc">12.2.1. <a href="#XSLTrefinement120122140121121120">Reference</a></span><br /><span class="subsubtoc">12.2.2. <a href="#XSLTrefinement121122140121121120">Transform</a></span><br /><span class="subsubtoc">12.2.3. <a href="#XSLTrefinement122122140121121120">Encoding</a></span><br /><span class="subtoc">12.3. <a href="#encryptedAttachments">Encrypted Attachments</a></span><br /><span class="subsubtoc">12.3.1. <a href="#XSLTrefinement120123140121121120">Reference</a></span><br /><span class="subsubtoc">12.3.2. <a href="#XSLTrefinement121123140121121120">Content</a></span><br /><span class="subsubtoc">12.3.3. <a href="#XSLTrefinement122123140121121120">Transform</a></span><br />13. <a href="#seccon">Security Considerations</a><br />
  Appendix I: <a href="#references">Referenced Specifications</a><br />
  Appendix II: <a href="#points">Extensibility Points</a><br />
  Appendix III:
  <a href="#acks">Acknowledgements</a><br /></p>
    <h2>
      <a name="introduction">1. </a>Introduction</h2>
    <p>This document defines the WS-I Basic Security Profile 1.0 (hereafter, "Profile"), consisting of a set of non-proprietary Web services 
                specifications, along with clarifications to and amplifications of those specifications which promote interoperability.</p>
    <p>Section 1 introduces the Profile, and relates the philosophy that it takes with regard to interoperability.</p>
    <p>Section 2, "Scope of the Profile," delimits the areas where the Profile improves interoperability.</p>
    <p>Section 3, "Profile Conformance," explains what it means to be conformant to the Profile. </p>
    <p>Each subsequent section addresses a component of the Profile, and consists of two parts; 
                an overview detailing the component specifications and their extensibility points, followed by subsections 
                that address individual parts of the component specifications. Note that there is no relationship between the section numbers
                in this document and those in the referenced specifications.</p>
    <h3>
      <a name="philosophy">1.1</a> Guiding Principles</h3>
    <p>The Profile was developed according to a set of principles that, together, 
                    form the philosophy of the Profile, as it relates to bringing about interoperability. This section
                    documents these guidelines.</p>
    <dl>
      <dt>No guarantee of interoperability</dt>
      <dd>Although it is impossible to completely
                        guarantee the interoperability of a particular
                        service, the Profile attempts to increase
                        interoperability by addressing the most common
                        problems that implementation experience has
                        revealed to date.</dd>
      <dt>Focus profiling effort</dt>
      <dd>The focus of the profile is the specifications that are explicitly defined as
						      in-scope for the profile. Other specifications are profiled to the minimal extent
						      necessary to allow meaningful profiling of the scoped specifications. This allows
						      an in-depth profile of the scoped specifications with reduced constraining of other
						      specifications.</dd>
      <dt>Application semantics</dt>
      <dd>Although communication of application
                        semantics can be facilitated by the
                        technologies that comprise the Profile,
                        assuring the common understanding of those
                        semantics is not addressed by it.</dd>
      <dt>Testability</dt>
      <dd>When possible, the Profile makes
                        statements that are testable. However, such
                        testability is not required. Preferably,
                        testing is achieved in a non-intrusive manner
                        (e.g., examining artifacts "on the
                        wire"). Note: Due to the nature of
                        cryptographic security, non-intrusive testing
                        may not be possible.</dd>
      <dt>Strength of requirements</dt>
      <dd>The Profile makes strong requirements
                        (e.g., MUST, MUST NOT) wherever feasible; if
                        there are legitimate cases where such a
                        requirement cannot be met, conditional
                        requirements (e.g., SHOULD, SHOULD NOT) are
                        used. Optional and conditional requirements
                        introduce ambiguity and mismatches between
                        implementations.</dd>
      <dt>Restriction vs. relaxation</dt>
      <dd>When amplifying the requirements of
                        referenced specifications (including the Basic
                        Profile 1.0 ), the Profile may restrict them,
                        but does not relax them (e.g., change a MUST
                        to a MAY). </dd>
      <dt>Multiple mechanisms</dt>
      <dd>If a referenced specification allows
                        multiple mechanisms to be used
                        interchangeably, the Profile selects those
                        that are well-understood, widely implemented
                        and useful. Extraneous or underspecified
                        mechanisms and extensions introduce complexity
                        and therefore reduce interoperability.</dd>
      <dt>Future compatibility</dt>
      <dd>When possible, the Profile aligns its
                        requirements with in-progress revisions to the
                        specifications it references (e.g., Web
                        Services Security). This aids implementers by
                        enabling a graceful transition, and assures
                        that WS-I does not 'fork' from these
                        efforts. When the Profile cannot address an
                        issue in a specification it references, this
                        information is communicated to the appropriate
                        body to assure its consideration.</dd>
      <dt>Compatibility with deployed services</dt>
      <dd>Backwards compatibility with deployed
                        Web services is not a goal for the Profile,
                        but due consideration is given to it; the
                        Profile does not introduce a change to the
                        requirements of a referenced specification
                        unless doing so addresses specific
                        interoperability issues.</dd>
      <dt>Focus on interoperability</dt>
      <dd>Although there are potentially a number
                        of inconsistencies and design flaws in the
                        referenced specifications, the Profile only
                        addresses those that affect
                        interoperability.</dd>
      <dt>Conformance targets</dt>
      <dd>Where possible, the Profile places
                        requirements on artifacts (e.g., WSDL
                        descriptions, SOAP messages) rather than the
                        producing or consuming software's behaviors or
                        roles. Artifacts are concrete, making them
                        easier to verify and therefore making
                        conformance easier to understand and less
                        error-prone.</dd>
      <dt>Lower-layer interoperability</dt>
      <dd>The BSP Profile speaks to
                        interoperability at the web-services layer
                        only; it assumes that interoperability of
                        lower-layer protocols ( e.g. TCP, HTTP ) and
                        technologies (e.g. encryption and signature
                        algorithms ) is adequate and
                        well-understood. WS-I does not attempt to
                        assure the interoperability of these protocols
                        and technologies as a whole. This assures that
                        WS-I's expertise in and focus on Web services
                        standards is used effectively.</dd>
      <dt>Do no harm</dt>
      <dd>Interoperability of security
                        technologies does not in and of itself ensure
                        security, and the act of combining new
                        technologies and protocols is especially
                        susceptible to security threats.  The profile
                        takes steps to avoid introducing new security
                        threats.</dd>
    </dl>
    <h3>
      <a name="conventions">1.2</a> Notational Conventions</h3>
    <p>The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", 
                    "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted 
                    as described in RFC2119.</p>
    <p>Normative statements in the Profile (i.e., those impacting conformance, as outlined in 
                    "Profile Conformance") are presented in the following manner:</p>
    <p class="statement">
      <span class="statement-id">Rnnnn</span> Statement text here.</p>
    <p>where "nnnn" is replaced by the statement number. Each statement contains exactly 
                    one requirement level keyword (e.g., "MUST") and one conformance target keyword 
                    (e.g., "SECURE_ENVELOPE").</p>
    <p>Some statements clarify the referenced specification(s), but do not place additional 
                    constraints upon implementations. For convenience, clarifications are annotated in the 
                    following manner: <span class="statement-type">C</span></p>
    <p>This specification uses a number of namespace prefixes throughout; their associated 
                    URIs are listed below. Note that the choice of any namespace prefix is arbitrary and not 
                    semantically significant.</p>
    <ul>
      <li>
        <strong>soap</strong> - "http://schemas.xmlsoap.org/soap/envelope/"</li>
      <li>
        <strong>xsd</strong> - "http://www.w3.org/2001/XMLSchema"</li>
      <li>
        <strong>ds</strong> - "http://www.w3.org/2000/09/xmldsig#"</li>
      <li>
        <strong>xenc</strong> - "http://www.w3.org/2001/04/xmlenc#"</li>
      <li>
        <strong>c14n</strong> - "http://www.w3.org/2001/10/xml-exc-c14n#"</li>
      <li>
        <strong>wsi</strong> - "http://ws-i.org/schemas/conformanceClaim/"</li>
      <li>
        <strong>wsse</strong> - "http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"</li>
      <li>
        <strong>wsu</strong> - "http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</li>
      <li>
        <strong>bp10</strong> - "http://www.ws-i.org/Profiles/Basic/2003-08/BasicProfile-1.0a.htm"</li>
      <li>
        <strong>bp11</strong> - "http://members.ws-i.org/dman/Document.phx/Private+Folders/Community+Folder/Working+Groups/WSBasic+Profile/Profile/v1.1/BasicProfile-1.1-WGAD.html?versionID=1"</li>
    </ul>
    <h2>
      <a name="scope">2. </a>Scope of the Profile</h2>
    <p>The <em>scope</em> of the Profile delineates the technologies that it addresses; in other words, the Profile only attempts 
                to improve interoperability within its own scope. Initially, the Profile's scope is bounded by the specifications 
                referenced by it; for a complete list of the Profile's referenced specifications, see Appendix I.</p>
    <p>The Profile's scope is further refined by <em>extensibility points</em>. Referenced specifications often provide extension 
                mechanisms and unspecified or open-ended configuration parameters. When identified as an extensibility point, 
                such a mechanism or parameter is outside the scope of the Profile, and its use is not subject to claims of conformance to this Profile.</p>
    <p>Because the use of extensibility points may impair interoperability, their use should be negotiated or documented 
                in some fashion by the parties to a Web service; for example, this could take the form of an out-of-band agreement.</p>
    <p>Note that the Profile may still place requirements on the use of an extensibility point, without constraining its range. 
                Also, specific uses of extensibility points may be further restricted by other profiles, to improve their interoperability 
                when used in conjunction with the Profile.</p>
    <p>For a complete list of the Profile's extensibility points, see Appendix II.</p>
    <h2>
      <a name="conformance">3. </a>Profile Conformance</h2>
    <p>Conformance to the Profile is defined by adherence to the set of requirements for a specific target, within the 
                scope of the Profile.</p>
    <p>The scope of the Profile is defined above ("Scope of the Profile"); conformance to the Profile is dependent upon 
                conformance to those referenced specifications that are in-scope, except when in conflict with the Profile's 
                Requirements, which take precedence for purposes of conformance.</p>
    <p>This Profile consists of Statements providing guidance and constraints on Message Artifacts (such as security headers, signatures and security tokens) and on the behavior of Senders and Receivers.
</p>
    <p>
      <em>Requirements</em> state the criteria for conformance to the Profile within its stated scope.
                They embody refinements, interpretations and clarifications that improve interoperability therein.
                Requirement levels, using RFC2119 language (e.g., MUST, MAY, SHOULD) indicate the nature of the requirement and its impact on conformance.
                Each requirement is individually identified (e.g., R9999) for convenience.
                Requirement identifiers are actually QNames and should be interpreted as if a default namespace whose URI is "http://ws-i.org.profiles/basic-security/core/1.0" is 'in-scope'.
                For example, the tuple for R9999 would be {"http://ws-i.org.profiles/basic-security/core/1.0" , R9999}</p>
    <p>Additional text may be included in the Profile to illuminate requirements (e.g., rationale and examples); however, 
                requirement statements alone should be considered in determining conformance.</p>
    <p>
      <em>Targets</em> allow for the description of conformance in different contexts, to allow conformance testing and certification of artifacts (such as SOAP messages), message senders and message receivers. The sections below describe the Profile's conformance targets. 
                </p>
    <p>To allow services to advertise conformance to the Profile, messages can be annotated with <em>conformance claims</em>, which use a URI to assert conformance with a particular profile.</p>
    <p>The conformance claim URI for section 6 of this Profile is "http://ws-i.org/profiles/basic-security/username-token/1.0".</p>
    <p>The conformance claim URI for section 7 of this Profile is "http://ws-i.org/profiles/basic-security/x.509-certificate-token/1.0".</p>
    <p>The conformance claim URI for section 12.1 of this Profile is "http://ws-i.org/profiles/basic-security/swa/1.0".</p>
    <p>The conformance claim URI for all other sections of this Profile is "http://ws-i.org.profiles/basic-security/core/1.0".</p>
    <p class="ednote">
      <strong>Editors' note:</strong>The conformance claim URI for this Profile is subject to change upon publication.</p>
    <h3>
      <a name="artifacts">3.1</a> Conformance of Artifacts</h3>
    <p>
                    The most basic level of conformance is that of an artifact.
                    An instance of an artifact is considered conformant when all of the requirements associated with it are met.
                    The Profile makes requirement statements about one kind of artifact:
                    </p>
    <ul>
      <li>
        <strong>SECURE_ENVELOPE</strong> - a SOAP envelope that has been subject to integrity and/or confidentiality protection.</li>
      <li>
        <strong>SECURE_MESSAGE</strong> - protocol elements that transport a message that have been subject to integrity and/or confidentiality protection.</li>
    </ul>
    <p>
                    A message is considered conformant when all of its contained Artifacts are conformant with all Statements related to SECURE_ENVELOPE or SECURE_MESSAGE as appropriate in the Profile.
                    Use of Artifacts for which there are no Statements in the Profile does not effect conformance.</p>
    <h3>
      <a name="senders">3.2</a> Conformance of Message Senders</h3>
    <p>A Sender is considered conformant when all of the Messages it produces are conformant and its behavior is conformant with all Statements related to SENDER in the Profile.</p>
    <ul>
      <li>
        <strong>SENDER</strong> - software that generates a message according to the protocol(s) associated with it.</li>
    </ul>
    <h3>
      <a name="receivers">3.3</a> Conformance of Message Receivers</h3>
    <p>A Receiver is considered conformant when it is capable of consuming conformant Messages containing the Artifacts that it supports and its behavior is conformant with all Statements related to RECEIVER in the Profile.
                    A conformant Receiver need not accept all possible conformant Messages.
                    A conformant Receiver may choose not to support Artifacts that provide unneeded or undesired functionality.
                    When a Receiver supports a specific Artifact, and the Profile contains Statements related to that Artifact, a conformant Receiver must accept all required conformant forms of that Artifact.
                    </p>
    <ul>
      <li>
        <strong>RECEIVER</strong> - software that consumes a message according to the protocol(s) associated with it.</li>
    </ul>
    <h3>
      <a name="claiming">3.4</a> Claiming Conformance</h3>
    <p>Claims of conformance to the Profile can be made using the mechanisms described in the Profile Conformance Framework. Specifically, claims can be made using the following conformance attachment mechanisms, as long as the requirements in this profile associated with the listed targets have been met:</p>
    <ul>
      <li>WSDL 1.1 Claim Attachment Mechanism for Web Services Instances - SECURE_ENVELOPE SENDER RECEIVER</li>
      <li>UDDI Claim Attachment Mechanism for Web Service Instances - SECURE_ENVELOPE SENDER RECEIVER</li>
    </ul>
    <p>Note that conformance does not apply to a service as a whole; only ports are considered when determining conformance of instances. Therefore, the Profile places no constraints on wsdl:service definitions. In particular, they can contain multiple wsdl:port elements, each of which may or may not be conformant.</p>
    <h2>
      <a name="transportsec">4. </a>Transport Layer Security</h2>
    <p>This section of the Profile incorporates the following
		specifications by reference, and defines extensibility points within
		them:</p>
    <ul>
      <li>
        <a href="http://www.ietf.org/rfc/rfc2818.txt">HTTP over TLS</a>
        <br />Extensibility points:
			<ul><li><span class="statement-id"><a name="E0001">E0001</a></span> - Ciphersuites - Additional ciphersuites may be specified.</li></ul></li>
    </ul>
    <h3>
      <a name="SSLTLS">4.1</a> SSL and TLS</h3>
    <p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p>
    <ul>
      <li>
        <a href="http://www.ietf.org/rfc/rfc2818.txt">HTTP over TLS: Section 2.2.1</a>
      </li>
    </ul>
    <p>SSL and TLS are both used as underlying protocols for HTTP/S. This profile places the following constraints on those protocols:</p>
    <div class="refinement">
      <h4 id="XSLTrefinement122121124121121120">4.1.1 Use of SSL 2.0</h4>
      <div class="rationale">
        <p>SSL 2.0 has known security issues and all current implementations of HTTP/S support more recent protocols. Therefore this profile prohibits use of SSL 2.0.</p>
      </div>
      <p class="statement">
        <span class="statement-id">
          <a name="R2001">R2001</a>
        </span> A SENDER MUST NOT use SSL 2.0 as the underlying protocol for HTTP/S</p>
      <p class="statement">
        <span class="statement-id">
          <a name="R2002">R2002</a>
        </span> A RECEIVER MUST NOT use SSL 2.0 as the underlying protocol for HTTP/S</p>
    </div>
    <h3>
      <a name="transportsecConsiderations">4.2</a> Security Considerations</h3>
    <p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p>
    <ul>
      <li>
        <a href="http://www.ietf.org/rfc/rfc2818.txt">HTTP over TLS</a>
      </li>
    </ul>
    <p>HTTP Headers are not protected when SSL or TLS is used.
                    This profile places the following constraints on the use of HTTP Headers:</p>
    <div class="refinement">
      <h4 id="XSLTrefinement122122124121121120">4.2.1 SOAPAction Header</h4>
      <div class="rationale">
        <p>
        </p>
      </div>
      <p class="statement">
        <span class="statement-id">
          <a name="C2010">C2010</a>
        </span> 
                        A SECURE_ENVELOPE SHOULD NOT be transmitted in an HTTP message containing a                        SOAPAction header in order to prevent processing based on this potentially
                        unsecured value. 
                    </p>
    </div>
    <h2>
      <a name="msgsec">5. </a>SOAP Message Security</h2>
    <p>This section of the Profile incorporates the following
		specifications by reference, and defines extensibility points within
		them:</p>
    <ul>
      <li>
        <a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security</a>
        <br />Extensibility points:
			<ul><li><span class="statement-id"><a name="E0002">E0002</a></span> - Security Tokens - Security tokens may be specified in additional security token profiles.</li></ul></li>
    </ul>
    <h3>
      <a name="WSSST">5.1</a> Security Tokens</h3>
    <p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p>
    <ul>
      <li>
        <a href="http://www.oasis-open.org/committees/download.php/3281/WSS-SOAPMessageSecurity-17-082703-merged.pdf">Web Services Security: SOAP Message Security Section 6</a>
      </li>
    </ul>
    <p class="ednote">
      <strong>Editors' note:</strong>The requirement statements in this section might be moved to a separate document in future.</p>This Profile places the following constraints on the use of Security Tokens:<div class="refinement"><h4 id="XSLTrefinement123121126121121120">5.1.1 Binary Security Token EncodingType Attribute</h4><div class="rationale"><p>
                        Base64Binary is the only encoding type specified by Web Services Security: SOAP Message Security.
                        Explicit specification of default values simplifies XML processing requirements.
                    </p></div><p class="statement"><span class="statement-id"><a name="R3029">R3029</a></span> 
                        Any wsse:BinarySecurityToken in a SECURE_ENVELOPE MUST have an EncodingType attribute.
                    </p><p class="statement"><span class="statement-id"><a name="R3030">R3030</a></span> 
                        An EncodingType attribute on a wsse:BinarySecurityToken element in a SECURE_ENVELOPE MUST have a value of
                        "http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary".
                    </p><div class="explanation"><p>
                        A BinarySecurityToken may specify its encoding type.
                        The Profile restricts the encoding type to Base64Binary and requires its explicit specification.
                    </p></div><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the wsse:BinarySecurityToken element is missing an EncodingType attribute --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement124121126121121120">5.1.2 Binary Security Token ValueType Attribute</h4><div class="rationale"><p>
                        Base64Binary is the only encoding type specified by Web Services Security: SOAP Message Security.
                        Explicit specification of default values simplifies XML processing requirements.
                    </p></div><p class="statement"><span class="statement-id"><a name="R3031">R3031</a></span> 
                        Any wsse:BinarySecurityToken element in a SECURE_ENVELOPE MUST have a ValueType attribute.
                    </p><p class="statement"><span class="statement-id"><a name="R3032">R3032</a></span> 
                        A ValueType attribute on a wsse:BinarySecurityToken element in a SECURE_ENVELOPE MUST have a value specified within the appropriate token profile.
                    </p><div class="explanation"><p>
                        A BinarySecurityToken may specify its value type.
                        The Profile restricts the value type to one of those specified by a security token profile and requires its specification.
                    </p></div><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the wsse:BinarySecurityToken element is missing a ValueType attribute --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the ValueType attribute on the wsse:BinarySecurityToken element has an incorrect value. --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://www.mta.org/NYC#SubwayToken"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
&lt;/wsse:Security&gt;
</pre></div></div><h3><a name="WSSTokenReferences">5.2</a> SecurityTokenReferences</h3><p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security Section 7</a></li></ul>
                    Web Services Security: SOAP Message Security defines a wsse:SecurityTokenReference
                    element for use in SOAP messages. This Profile places the following constraints on its use:
                <div class="refinement"><h4 id="XSLTrefinement122122126121121120">5.2.1 Use of wsse:SecurityTokenReference</h4><div class="rationale"><p>
                        Consistent use of a single security token reference method increases the likelihood of interoperability.
                    </p></div><p class="statement"><span class="statement-id"><a name="R3021">R3021</a></span> 
                        When a Security Token is referenced within a wsse:Security header in a SECURE_ENVELOPE, it MUST be referenced by using a wsse:SecurityTokenReference element.
                    </p><div class="explanation"><p>
                        There are many methods to refer to security tokens.
                        The Profile requires use of wsse:SecurityTokenReference.
                    </p></div><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it carries an inline X509 certificate using an ds:X509Data element inside the 
     ds:KeyInfo element rather than refering to a wsse:BinarySecurityToken element using the wsse:SecurityTokenReference element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
      &lt;ds:SignedInfo&gt;
         &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
         &lt;/ds:CanonicalizationMethod&gt;
         &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
         &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
               &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                  &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                            PrefixList='' /&gt;
               &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;i3qi5GjhHnfoBn/jOjQp2mq0Na4=&lt;/ds:DigestValue&gt;
         &lt;/ds:Reference&gt;
      &lt;/ds:SignedInfo&gt;
      &lt;ds:SignatureValue&gt;PipXJ2Sfc+LTDnq4pM5JcIYt9gg=&lt;/ds:SignatureValue&gt;
      &lt;ds:KeyInfo&gt;
         &lt;ds:X509Data&gt;
            &lt;ds:X509Certificate&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
           &lt;/ds:X509Certificate&gt;
         &lt;/ds:X509Data&gt;
      &lt;/ds:KeyInfo&gt;
   &lt;/ds:Signature&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it refers to an external X509 certificate using ds:X509IssueSerial element 
     inside a ds:KeyInfo element rather than using a wsse:SecurityTokenReference element inside the ds:KeyInfo element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;xenc:EncryptedKey&gt;
      &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
      &lt;ds:KeyInfo&gt;
         &lt;ds:X509Data&gt;
            &lt;ds:X509IssuerSerial&gt;
               &lt;ds:X509IssuerName&gt;CN=Security WG, OU=BSP, O=WS-I, C=US&lt;/ds:X509IssuerName&gt;
               &lt;ds:X509SerialNumber&gt;54A4E9&lt;/ds:X509SerialNumber&gt;
            &lt;/ds:X509IssuerSerial&gt;
         &lt;/ds:X509Data&gt;
      &lt;/ds:KeyInfo&gt;
      &lt;xenc:CipherData&gt;
         &lt;xenc:CipherValue&gt;
            XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
         &lt;/xenc:CipherValue&gt;
      &lt;/xenc:CipherData&gt;
   &lt;/xenc:EncryptedKey&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
      &lt;ds:SignedInfo&gt;
         &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
         &lt;/ds:CanonicalizationMethod&gt;
         &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
         &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
               &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                  &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                            PrefixList='' /&gt;
               &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;i3qi5GjhHnfoBn/jOjQp2mq0Na4=&lt;/ds:DigestValue&gt;
         &lt;/ds:Reference&gt;
      &lt;/ds:SignedInfo&gt;
      &lt;ds:SignatureValue&gt;PipXJ2Sfc+LTDnq4pM5JcIYt9gg=&lt;/ds:SignatureValue&gt;
      &lt;ds:KeyInfo&gt;
         &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
         &lt;/wsse:SecurityTokenReference&gt;
      &lt;/ds:KeyInfo&gt;
   &lt;/ds:Signature&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;xenc:EncryptedKey&gt;
      &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
      &lt;ds:KeyInfo&gt;
         &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
         &lt;/wsse:SecurityTokenReference&gt;
      &lt;/ds:KeyInfo&gt;
      &lt;xenc:CipherData&gt;
         &lt;xenc:CipherValue&gt;
            XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
         &lt;/xenc:CipherValue&gt;
      &lt;/xenc:CipherData&gt;
   &lt;/xenc:EncryptedKey&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement123122126121121120">5.2.2 Internal References</h4><div class="rationale"><p>
                       Reference by Key Identifier may be ambiguous.
                    </p></div><p class="statement"><span class="statement-id"><a name="R3022">R3022</a></span> 
                       When a wsse:SecurityTokenReference element in a SECURE_ENVELOPE references a Security Token contained within that message, and that Security Token carries an attribute of type ID, it MUST be referred to using either a Direct Reference or an Embedded Reference.
                    </p><div class="explanation"><p>
                       Direct and Embedded are preferred over Key Identifier References.
                    </p></div><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it refers to a wsse:BinarySecurityToken element using a wsse:KeyIdentifier 
     element rather than a wsse:Reference or wsse:Embedded element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:KeyIdentifier EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"
                          ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#X509SubjectKeyIdentifier"&gt;
         MIGfMa0GCSq
      &lt;/wsse:KeyIdentifier&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Reference URI='#SomeCert'
                      ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Embedded wsu:Id="TheEmbeddedElementAroundSomeCert"&gt;
         &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                   ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                                   EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
         &lt;/wsse:BinarySecurityToken&gt;
      &lt;/wsse:Embedded&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement124122126121121120">5.2.3 Shorthand XPointer References</h4><div class="rationale"><p>
                    The wsse:BinarySecurityToken has a wsu:Id attribute allowing references to use shorthand XPointers.
                  </p></div><p class="statement"><span class="statement-id"><a name="R5204">R5204</a></span> 
                    When a wsse:SecurityTokenReference element in a SECURE_ENVELOPE uses a Direct Reference to a Security Token contained within that message, it MUST use a shorthand XPointer reference to the element containing the Security Token.
                  </p><p class="example-banner">For example,</p><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
 &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                           ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                           EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
 &lt;/wsse:BinarySecurityToken&gt;
 &lt;xenc:EncryptedKey&gt;
   &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
   &lt;ds:KeyInfo&gt;
    &lt;wsse:SecurityTokenReference&gt;
     &lt;wsse:Reference URI='#SomeCert' /&gt;
    &lt;/wsse:SecurityTokenReference&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;xenc:CipherData&gt;
     &lt;xenc:CipherValue&gt;
       XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
     &lt;/xenc:CipherValue&gt;
   &lt;/xenc:CipherData&gt;
 &lt;/xenc:EncryptedKey&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement125122126121121120">5.2.4 References to Preceding Security Tokens</h4><div class="rationale"><p>
                    Ensuring that a security token appears before it is referenced means that the implementations already have the token to hand when it is needed to verify a signature or perform decryption.
                  </p></div><p class="statement"><span class="statement-id"><a name="R5205">R5205</a></span> 
                    When a wsse:BinarySecurityToken element is included in a SECURE_ENVELOPE it MUST precede the first wsse:SecurityTokenReference element that references it.
                  </p><div class="explanation"><p>
                    Any wsse:BinarySecurityToken element must appear before a referencing wsse:SecurityTokenReference element in document order.
                  </p></div><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the wsse:BinarySecurityToken with the wsu:ID of SomeCert appears after it is 
     referenced from within the xenc:EncryptedKey element --&gt; 

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
 &lt;xenc:EncryptedKey&gt;
   &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
   &lt;ds:KeyInfo&gt;
     &lt;wsse:SecurityTokenReference&gt;
       &lt;wsse:Reference URI='#SomeCert' /&gt;
     &lt;/wsse:SecurityTokenReference&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;xenc:CipherData&gt;
     &lt;xenc:CipherValue&gt;
       XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
     &lt;/xenc:CipherValue&gt;
   &lt;/xenc:CipherData&gt;
 &lt;/xenc:EncryptedKey&gt;
 &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                           ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                           EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
 &lt;/wsse:BinarySecurityToken&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
 &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                           ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                           EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
 &lt;/wsse:BinarySecurityToken&gt;
 &lt;xenc:EncryptedKey&gt;
   &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
   &lt;ds:KeyInfo&gt;
     &lt;wsse:SecurityTokenReference&gt;
       &lt;wsse:Reference URI='#SomeCert' /&gt;
     &lt;/wsse:SecurityTokenReference&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;xenc:CipherData&gt;
     &lt;xenc:CipherValue&gt;
       XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
     &lt;/xenc:CipherValue&gt;
   &lt;/xenc:CipherData&gt;
 &lt;/xenc:EncryptedKey&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement126122126121121120">5.2.5 Direct Preferred to Embedded for Internal References</h4><div class="rationale"><p>Since multiple security elements may reference a single token and processing
                    of those elements may result in the removal of the element, consistent use of direct rather
                    than embedded references simplifies processing.</p></div><p class="statement"><span class="statement-id"><a name="R3023">R3023</a></span> 
                       When a wsse:SecurityTokenReference element in a SECURE_ENVELOPE references
                       a Security Token contained within that message,
                       and that Security Token might be referenced in several places within the message,
                       it SHOULD be referred to using a Direct Reference rather than an Embedded Reference.
                    </p><div class="explanation"><p>
                      Direct references are encouraged.
                      Embedded references are discouraged.
                    </p></div><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it uses a wsse:Embedded element for the wsse:BinarySecurityToken 
     with the wsu:Id of SomeCert. It is assumed that this token is referred to from several places elsewhere
     in the SOAP envelope ( not shown )  --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Embedded wsu:Id="TheEmbeddedElementAroundSomeCert"&gt;
         &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                   ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                                   EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
         &lt;/wsse:BinarySecurityToken&gt;
      &lt;/wsse:Embedded&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Reference URI='#SomeCert'
                      ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><p class="ednote"><strong>Editors' note:</strong>
                      The "incorrect" example above is used to show correct use of embedded reference with R3022,
                      but since embedded references are discouraged here,
                      it is used to show incorrect token reference.
                    </p></div><div class="refinement"><h4 id="XSLTrefinement127122126121121120">5.2.6 Direct Required When Possible for External References</h4><p class="statement"><span class="statement-id"><a name="R3024">R3024</a></span> 
                       When a wsse:SecurityTokenReference element in a SECURE_ENVELOPE references a Security Token not contained within that message, and that security Token can be referred to using a Direct Reference, it MUST be referred to using a Direct Reference.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Reference URI='http://www.ws-i.org/CertStore/Examples/BSP.PEM'
                      ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement128122126121121120">5.2.7 Format of Embedded References</h4><p class="statement"><span class="statement-id"><a name="R3025">R3025</a></span> 
                      When a wsse:Embedded element in a SECURE_ENVELOPE is used to specify a security token inline within a wsse:SecurityTokenReference element, the format of the contained security token MUST be the same as if the security token was a child of a wsse:Security element.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the wsse:Embedded element carries the date for the X509 certificate directly 
     rather than as a wsse:BinarySecurityToken element  --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Embedded wsu:Id="SomeCert"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:Embedded&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Embedded wsu:Id="TheEmbeddedElementAroundSomeCert"&gt;
         &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                   ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                                   EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
         &lt;/wsse:BinarySecurityToken&gt;
      &lt;/wsse:Embedded&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement129122126121121120">5.2.8 Key Identifier for External References</h4><p class="statement"><span class="statement-id"><a name="R3026">R3026</a></span> 
                      When a wsse:SecurityTokenReference element in a SECURE_ENVELOPE references a Security Token not contained within that message, and that Security Token cannot be referred to using a Direct Reference but can be referred to using a Key Identifier, it MUST be referred to using a Key Identifier.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:KeyIdentifier EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"
                          ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#X509SubjectKeyIdentifier" &gt;
         MIGfMa0GCSq
      &lt;/wsse:KeyIdentifier&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement130122126121121120">5.2.9 Key Name References Prohibited</h4><p class="statement"><span class="statement-id"><a name="R3027">R3027</a></span> 
                      A wsse:SecurityTokenReference element in a SECURE_ENVELOPE MUST NOT use a Key Name to reference a Security Token.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it uses a ds:X509IssuerName element to refer to an X509 certificate  --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;ds:X509Data&gt;
         &lt;ds:X509IssuerSerial&gt;
            &lt;ds:X509IssuerName&gt;CN=Security WG, OU=BSP, O=WS-I, C=US&lt;/ds:X509IssuerName&gt;
            &lt;ds:X509IssuerSerial&gt;54A4E9&lt;/ds:X509IssuerSerial&gt;
         &lt;/ds:X509IssuerSerial&gt;
      &lt;/ds:X509Data&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it uses a ds:KeyName element to refer to an X509 certificate  --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;ds:KeyName&gt;CN=Security WG, OU=BSP, O=WS-I, C=US&lt;/ds:KeyName&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement131122126121121120">5.2.10 ds:KeyInfo/wsse:SecurityTokenReference in XML Signatures</h4><p class="statement"><span class="statement-id"><a name="R3052">R3052</a></span> 
                      If a ds:Signature element within a wsse:Security header in a SECURE_ENVELOPE contains a ds:KeyInfo then a wsse:SecurityTokenReference element MUST be used to refer to the security token used for the signature.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it uses a ds:X509Data element to provide token information rather than using 
     a wsse:SecurityTokenReference element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
      &lt;ds:SignedInfo&gt;
         &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
         &lt;/ds:CanonicalizationMethod&gt;
         &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
         &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
               &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                  &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                            PrefixList='' /&gt;
               &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;i3qi5GjhHnfoBn/jOjQp2mq0Na4=&lt;/ds:DigestValue&gt;
         &lt;/ds:Reference&gt;
      &lt;/ds:SignedInfo&gt;
      &lt;ds:SignatureValue&gt;PipXJ2Sfc+LTDnq4pM5JcIYt9gg=&lt;/ds:SignatureValue&gt;
      &lt;ds:KeyInfo&gt;
         &lt;ds:X509Data&gt;
            &lt;ds:X509Certificate&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
            &lt;/ds:X509Certificate&gt;
         &lt;/ds:X509Data&gt;
      &lt;/ds:KeyInfo&gt;
   &lt;/ds:Signature&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
      &lt;ds:SignedInfo&gt;
         &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
         &lt;/ds:CanonicalizationMethod&gt;
         &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
         &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
               &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                  &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                            PrefixList='' /&gt;
               &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;i3qi5GjhHnfoBn/jOjQp2mq0Na4=&lt;/ds:DigestValue&gt;
         &lt;/ds:Reference&gt;
      &lt;/ds:SignedInfo&gt;
      &lt;ds:SignatureValue&gt;PipXJ2Sfc+LTDnq4pM5JcIYt9gg=&lt;/ds:SignatureValue&gt;
      &lt;ds:KeyInfo&gt;
         &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
         &lt;/wsse:SecurityTokenReference&gt;
      &lt;/ds:KeyInfo&gt;
   &lt;/ds:Signature&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement132122126121121120">5.2.11 ds:KeyInfo/wsse:SecurityTokenReference in XML Encryption</h4><p class="statement"><span class="statement-id"><a name="R3053">R3053</a></span> 
                        If an xenc:EncryptedData or xenc:EncryptedKey element within a wsse:Security header in a SECURE_ENVELOPE contains a ds:KeyInfo then a wsse:SecurityTokenReference element MUST be used to refer to the relevant Security Token.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it uses a ds:X509Data element to provide token information rather than using 
     a wsse:SecurityTokenReference element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;xenc:EncryptedKey&gt;
      &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
      &lt;ds:KeyInfo&gt;
         &lt;ds:X509Data&gt;
            &lt;ds:X509Certificate&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
            &lt;/ds:X509Certificate&gt;
         &lt;/ds:X509Data&gt;
      &lt;/ds:KeyInfo&gt;
      &lt;xenc:CipherData&gt;
         &lt;xenc:CipherValue&gt;
            XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
         &lt;/xenc:CipherValue&gt;
      &lt;/xenc:CipherData&gt;
   &lt;/xenc:EncryptedKey&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;xenc:EncryptedKey&gt;
      &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
      &lt;ds:KeyInfo&gt;
         &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
         &lt;/wsse:SecurityTokenReference&gt;
      &lt;/ds:KeyInfo&gt;
      &lt;xenc:CipherData&gt;
         &lt;xenc:CipherValue&gt;
            XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
         &lt;/xenc:CipherValue&gt;
      &lt;/xenc:CipherData&gt;
   &lt;/xenc:EncryptedKey&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement133122126121121120">5.2.12 KeyIdentifier/@ValueType Attribute</h4><p class="statement"><span class="statement-id"><a name="R3054">R3054</a></span> 
                      Any wsse:KeyIdentifier element in a SECURE_ENVELOPE MUST have a ValueType attribute.
                    </p><p class="statement"><span class="statement-id"><a name="R3063">R3063</a></span> 
                      A ValueType attribute on a wsse:KeyIdentifier element in a SECURE_ENVELOPE MUST have a value specified within the appropriate token profile.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the wsse:KeyIdentifier element is missing a ValueType attribute --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:KeyIdentifier
            EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
         MIGfMa0GCSq
      &lt;/wsse:KeyIdentifier&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:KeyIdentifier EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"
                          ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#X509SubjectKeyIdentifier" &gt;
         MIGfMa0GCSq
      &lt;/wsse:KeyIdentifier&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement134122126121121120">5.2.13 Children of wsse:Embedded</h4><p class="statement"><span class="statement-id"><a name="R3055">R3055</a></span> 
                      A wsse:Embedded element in a SECURE_ENVELOPE MUST NOT contain a wsse:SecurityTokenReference child element.
                    </p><p class="statement"><span class="statement-id"><a name="R3060">R3060</a></span> 
                      A wsse:Embedded element in a SECURE_ENVELOPE MUST contain a single child element for a security token from an appropriate token profile.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the wsse:Embedded element contains a wsse:SecurityTokenReference element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Embedded wsu:Id="TheEmbeddedElementAroundSomeSTR"&gt;
         &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
        &lt;/wsse:SecurityTokenReference&gt;
      &lt;/wsse:Embedded&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the wsse:Embedded element has multiple element children --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Embedded wsu:Id="TheEmbeddedElementAroundSomeCerts"&gt;
         &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                   ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                                   EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
         &lt;/wsse:BinarySecurityToken&gt;
         &lt;wsse:BinarySecurityToken wsu:Id='SomeOtherCert'
                                   ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                                   EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
         &lt;/wsse:BinarySecurityToken&gt;
      &lt;/wsse:Embedded&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Embedded wsu:Id="TheEmbeddedElementAroundSomeCert"&gt;
         &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                   ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                                   EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
         &lt;/wsse:BinarySecurityToken&gt;
      &lt;/wsse:Embedded&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><p class="ednote"><strong>Editors' note:</strong>We need to figure out exactly what 'appropriate' means in this context.</p></div><div class="refinement"><h4 id="XSLTrefinement135122126121121120">5.2.14 Reference from wsse:SecurityTokenReference to wsse:SecurityTokenReference</h4><p class="statement"><span class="statement-id"><a name="R3056">R3056</a></span> 
                      A wsse:SecurityTokenReference element in a SECURE_ENVELOPE MUST NOT contain a direct reference to another wsse:SecurityTokenReference element that does not have a wsse:Embedded child element.
                    </p><p class="statement"><span class="statement-id"><a name="R3064">R3064</a></span> 
					  When wsse:SecurityTokenReference element in a SECURE_ENVELOPE contains a direct reference to an security token contained within an wsse:Embedded element, the reference MUST be to the contained token not to the wsse:Embedded element.</p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the second wsse:SecurityTokenReference element refers to the 
     wsse:SecurityTokenReference with an wsu:Id of TheFirstSTR  --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                             ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                             EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;wsse:SecurityTokenReference wsu:Id="TheFirstSTR"&gt;
      &lt;wsse:Reference URI='#SomeCert'
                      ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
   &lt;/wsse:SecurityTokenReference&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Reference URI='#TheFirstSTR'
                      ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Embedded wsu:Id="TheEmbeddedElementAroundSomeCert"&gt;
         &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                   ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"
                                   EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
         &lt;/wsse:BinarySecurityToken&gt;
      &lt;/wsse:Embedded&gt;
   &lt;/wsse:SecurityTokenReference&gt;
   &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Reference URI='#SomeCert'
                      ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" /&gt;
   &lt;/wsse:SecurityTokenReference&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement136122126121121120">5.2.15 wsse:SecurityTokenReference/Reference ValueType Attribute</h4><p class="statement"><span class="statement-id"><a name="R3059">R3059</a></span> 
                      A wsse:SecurityTokenReference/wsse:Reference element in a SECURE_ENVELOPE MUST have a ValueType attribute.
                    </p><p class="statement"><span class="statement-id"><a name="R3058">R3058</a></span> 
                      The value of a ValueType attribute on any wsse:SecurityTokenReference/wsse:Reference element in a SECURE_ENVELOPE MUST match the value of the ValueType attribute, if any, on the referenced token.
                    </p></div><div class="refinement"><h4 id="XSLTrefinement137122126121121120">5.2.16 wsse:SecurityTokenReference constraints</h4><p class="statement"><span class="statement-id"><a name="R3061">R3061</a></span> 
                    A wsse:SecurityTokenReference element in a SECURE_ENVELOPE MUST have exactly one child element
                  </p><p class="statement"><span class="statement-id"><a name="R3062">R3062</a></span> 
                    A wsse:SecurityTokenReference/wsse:Reference element in a SECURE_ENVELOPE MUST have a URI attribute
                  </p></div><div class="refinement"><h4 id="XSLTrefinement138122126121121120">5.2.17 wsse:SecurityTokenReference Dereferencing Transform</h4><p class="statement"><span class="statement-id"><a name="R3065">R3065</a></span> 
                        When a SECURE_ENVELOPE uses the SecurityTokenReference Dereferencing Transform,
                        the ds:CanonicalizationMethod element MUST be present and wrapped in a
                        wsse:TransformationParameters element.
                    </p></div><h3><a name="WSSTimeStamp">5.3</a> Timestamps</h3><p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security Section 10</a></li></ul><p>Web Services Security: SOAP Message Security defines a Timestamp element for
                    use in SOAP messages. This Profile places the following constraints on its use:</p><div class="refinement"><h4 id="XSLTrefinement122123126121121120">5.3.1 wsu:Timestamp</h4><div class="rationale"><p>
                    The wsu:Created element represents the creation time of the security semantics. This element is REQUIRED and can only be specified once in a Timestamp element.    Within the SOAP processing model, creation is the instant that the Infoset is serialized for transmission.
                    </p></div><p class="statement"><span class="statement-id"><a name="R3203">R3203</a></span> 
                      Any wsu:Timestamp element in a wsse:Security header in a SECURE_ENVELOPE MUST have exactly one wsu:Created element child.
                    </p><p class="statement"><span class="statement-id"><a name="R3213">R3213</a></span> 
                        A wsu:Timestamp within a SECURE_ENVELOPE MUST NOT include wsse:Created or wsse:Expires
                        values that specify leap seconds.
                    </p><p class="statement"><span class="statement-id"><a name="R3217">R3217</a></span> 
                        A wsu:Timestamp within a SECURE_ENVELOPE MUST contain time instants only in UTC format                        as specified by the XML Schema type (dateTime).
                    </p><p class="statement"><span class="statement-id"><a name="R3218">R3218</a></span> 
                        The wsu:Timestamp within a SECURE_ENVELOPE when present as a descendant of a                        wsse:Security element MUST be a child of that element.
                    </p><p class="statement"><span class="statement-id"><a name="R3219">R3219</a></span> 
                        The wsu:Timestamp element within a SECURE_ENVELOPE when present as a child of a                        wsse:Security element MUST NOT appear more than once within that wsse:Security element.
                    </p><p class="statement"><span class="statement-id"><a name="R3220">R3220</a></span> 
                        The wsu:Created and wsu:Expires elements within a SECURE_ENVELOPE MUST appear at most
                        once within a wsu:Timestamp element.
                    </p><p class="statement"><span class="statement-id"><a name="R3221">R3221</a></span> 
                        If wsu:Created and wsu:Expires elements both appear within a SECURE_ENVELOPE
                        they MUST appear in the order: wsu:Created then wsu:Expires.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the wsu:Timestamp element is missing a wsu:Created child element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' &gt;
 &lt;wsu:Timestamp wsu:Id="timestamp"&gt;
   &lt;wsu:Expires&gt;2001-10-13T09:00:00Z&lt;/wsu:Expires&gt;
 &lt;/wsu:Timestamp&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' 
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' &gt;
 &lt;wsu:Timestamp wsu:Id="timestamp"&gt;
   &lt;wsu:Created&gt;2001-09-13T08:42:00Z&lt;/wsu:Created&gt;
   &lt;wsu:Expires&gt;2001-10-13T09:00:00Z&lt;/wsu:Expires&gt;
 &lt;/wsu:Timestamp&gt;
&lt;/wsse:Security&gt;
</pre></div></div><h3><a name="WSSReferences">5.4</a> wsu:Id References</h3><p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security</a></li></ul><p>Web Services Security: SOAP Message Security defines a wsu:Id element for
                    use in SOAP messages. This Profile places the following constraints on its use:</p><div class="refinement"><h4 id="XSLTrefinement122124126121121120">5.4.1 wsu:Id Attribute Uniqueness</h4><p class="statement"><span class="statement-id"><a name="R3204">R3204</a></span> 
                        Two wsu:Id attributes within any SECURE_ENVELOPE MUST NOT have the same value.
                    </p></div><h3><a name="WSSProcessing">5.5</a> wsse:Security Processing Order</h3><p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security</a></li></ul><p>Web Services Security: SOAP Message Security defines the order for processing
                    signature and encryption blocks within wsse:Security headers.
                    This Profile provides the following guidance:</p><div class="refinement"><h4 id="XSLTrefinement122125126121121120">5.5.1 Order of Processing</h4><p class="statement"><span class="statement-id"><a name="R3212">R3212</a></span> 
                        Within a SECURE_ENVELOPE, the ds:Signature and/or the encryption sub-elements
                        (xenc:EncryptedKey or xenc:ReferenceList) MUST be ordered within the wsse:Security
                        header so a receiver will get the correct result by processing the elements in the
                        order they appear within each wsse:Security header.
                    </p></div><h3><a name="WSSActor">5.6</a> SOAP Actor</h3><p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security</a></li></ul><p>SOAP defines an actor attribute for use in SOAP headers.
                    This Profile places the following constraints on its use:</p><div class="refinement"><h4 id="XSLTrefinement122126126121121120">5.6.1 SOAP Actor Value</h4><p class="statement"><span class="statement-id"><a name="R3206">R3206</a></span> 
                        Within a SECURE_ENVELOPE there MUST be at most one wsse:Security header block with the
                        actor attribute omitted.
                    </p><p class="statement"><span class="statement-id"><a name="R3210">R3210</a></span> 
                        Within a SECURE_ENVELOPE there MUST be at most one wsse:Security header block with the
                        same actor attribute value.
                    </p></div><h2><a name="usernametoken">6. </a>Username Token Profile</h2><p>This section of the Profile incorporates the following
		specifications by reference, and defines extensibility points within
		them:</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0.pdf">Web Services Security: Username Token Profile</a></li></ul><h3><a name="tokenusage">6.1</a> Token Usage</h3><div class="refinement"><h4 id="XSLTrefinement120121128121121120">6.1.1 wsse:UsernameToken/wsse:Password/@Type</h4><div class="rationale"><p>To avoid ambiguity, the Type attribute must always be specified on the wsse:Password element of a wsse:UsernameToken</p></div><p class="statement"><span class="statement-id"><a name="R4201">R4201</a></span> 
                       When a wsse:UsernameToken/wsse:Password element is present in a SECURE_ENVELOPE its Type attribute MUST be explicitly present.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the wsse:Password element is missing a Type attribute with a value of 
     http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText --&gt;

&lt;wsse:UsernameToken xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' &gt;
 &lt;wsse:Username&gt;Bert&lt;/wsse:Username&gt;
 &lt;wsse:Password&gt;Ernie&lt;/wsse:Password&gt;
&lt;/wsse:UsernameToken&gt;
</pre></div><div class="example"><p class="incorrect">INCORRECT: </p><pre>&lt;
&lt;!-- This example is incorrect because the wsse:Password element is missing a Type attribute with a value of 
     http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest --&gt;

&lt;wsse:UsernameToken xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' &gt;
 &lt;wsse:Username&gt;Bert&lt;/wsse:Username&gt;
 &lt;wsse:Password&gt;B5twk47KwSrjeg==&lt;/wsse:Password&gt;
&lt;/wsse:UsernameToken&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:UsernameToken xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' &gt;
 &lt;wsse:Username&gt;Bert&lt;/wsse:Username&gt;
 &lt;wsse:Password Type='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText'&gt;Ernie&lt;/wsse:Password&gt;
&lt;/wsse:UsernameToken&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:UsernameToken xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' &gt;
 &lt;wsse:Username&gt;Bert&lt;/wsse:Username&gt;
 &lt;wsse:Password Type='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest'&gt;B5twk47KwSrjeg==&lt;/wsse:Password&gt;
&lt;/wsse:UsernameToken&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement121121128121121120">6.1.2 PasswordDigest</h4><p class="statement"><span class="statement-id"><a name="R4212">R4212</a></span> 
				            When the wsse:PasswordDigest element is used within a SECURE_ENVELOPE,
				            its value MUST be computed using the following formula,
				            where "+" indicates concatenation:
				            Password_Digest = Base64 ( SHA-1 ( nonce + created + password ) ).
				            That is, concatenate the nonce, creation timestamp, and the password
				            (or shared secret or password equivalent), digest the combination using
				            the SHA-1 hash algorithm, then include the Base64 encoding of that result
				            as the password (digest).
				            Any elements that are not present are simply omitted from the concatenation.
				        </p></div><div class="refinement"><h4 id="XSLTrefinement122121128121121120">6.1.3 wsse:Nonce</h4><p class="statement"><span class="statement-id"><a name="R4213">R4213</a></span> 
				            Each SECURE_ENVELOPE including a wsse:Nonce element MUST use a nonce value
				            which is different from all previous nonce values used by that SENDER.
				        </p></div><div class="refinement"><h4 id="XSLTrefinement123121128121121120">6.1.4 ValueType attribute</h4><p class="statement"><span class="statement-id"><a name="R4214">R4214</a></span> 
				            When a UsernameToken is referenced within a SECURE_ENVELOPE using a
				            wsse:SecurityTokenReference and the ValueType attribute is used,
				            its value MUST be
				            "http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#UsernameToken".
				        </p></div><div class="refinement"><h4 id="XSLTrefinement124121128121121120">6.1.5 Reference by KeyIdentifier</h4><p class="statement"><span class="statement-id"><a name="R4215">R4215</a></span> 
				            When a wsse:SecurityTokenReference element is used within a SECURE_ENVELOPE to refer
				            to a wsse:UsernameToken, a KeyIdentifier reference MUST NOT be used.
				        </p></div><div class="refinement"><h4 id="XSLTrefinement125121128121121120">6.1.6 Key Derivation</h4><div class="explanation"><p>The Username Token profile does not currently define a Key derivation algorithm. The OASIS WSS TC is expected to address this issue sometime in the future. See <a href="http://members.ws-i.org/dman/Document.phx/Private+Folders/Community+Folder/Working+Groups/WSBasic+Security+Profile/Working+Documents/Profile/v1.0/Basic+Security+Profile+1.0+Issues+List?cmd=download#utp07">UTP07</a> for discussion of this issue.
				        </p></div></div><div class="refinement"><h4 id="XSLTrefinement126121128121121120">6.1.7 Sign UsernameToken</h4><p class="statement"><span class="statement-id"><a name="C4210">C4210</a></span> 
                         A wsse:UsernameToken in a SECURE_ENVELOPE which contains a wsse:Nonce element                         SHOULD be referenced by a ds:Reference in a ds:SignedInfo element in order to
                         prevent replay. 
                    </p><p class="statement"><span class="statement-id"><a name="C4211">C4211</a></span> 
                         A wsse:UsernameToken in a SECURE_ENVELOPE which contains a wsu:Created element                         SHOULD be referenced by a ds:Reference in a ds:SignedInfo element in order to
                         prevent replay. 
                    </p></div><h2><a name="x509token">7. </a>X.509 Certificate Token Profile</h2><p>This section of the Profile incorporates the following
		specifications by reference, and defines extensibility points within
		them:</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0.pdf">Web Services Security: X.509 Token Profile</a></li></ul><h3><a name="x509tokentypes">7.1</a> Token Types</h3><p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0.pdf">Web Services Security: X.509 Token Profile Section 3.1</a></li></ul><p>Web Services Security: X.509 Token Profile defines 3 token types.
                    This Profile places the following constraints on their use:</p><div class="refinement"><h4 id="XSLTrefinement122121130121121120">7.1.1 Certificate Path</h4><div class="rationale"><p>
                    Interoperability issues may arise if different forms of certificate path
                    information are used when not expected. X509PKIPathv1 is preferred because
                    it allows more efficient certificate path processing.
                    PKCS7 is a more mature and widely implemented standard so it is also allowed.
                  </p></div><p class="statement"><span class="statement-id"><a name="R5201">R5201</a></span> 
                    When certificate path information is provided, a SENDER MUST provide
                    one of the X509PKIPathv1 or PKCS7 token types.
                  </p><p class="statement"><span class="statement-id"><a name="R5202">R5202</a></span> 
                    When certificate path information is provided, a SENDER SHOULD provide
                    the X509PKIPathv1 token type.
                  </p><p class="statement"><span class="statement-id"><a name="R5203">R5203</a></span> 
                    When certificate path information is provided, a RECEIVER MUST accept
                    X509PKIPathv1 and PKCS7 token types.
                  </p></div><div class="refinement"><h4 id="XSLTrefinement123121130121121120">7.1.2 KeyIdentifier</h4><p class="statement"><span class="statement-id"><a name="R5206">R5206</a></span> 
                    When the wsse:KeyIdentifier element is used within a SECURE_ENVELOPE to specify
                    a reference to an X.509 certificate, the wsse:KeyIdentifier element MUST have ValueType
                    attribute with the value
                    http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#X509SubjectKeyIdentifier
                    and its contents MUST be the value of the certificate's X.509 SubjectKeyIdentifier
                    extension.
                  </p></div><div class="refinement"><h4 id="XSLTrefinement124121130121121120">7.1.3 Use of SecurityTokenReference</h4><p class="statement"><span class="statement-id"><a name="R5207">R5207</a></span> 
                    Within a SECURE_ENVELOPE, a wsse:SecurityTokenReference element MUST be used to specify
                    all references to X.509 token types in signature or encryption elements.
                  </p></div><h2><a name="xmlSignature">8. </a>XML-Signature</h2><p>Web Services Security: SOAP Message Security builds on XML Signature,
              defining usage of various elements from XML Signature and a processing model.
              This Profile places the constraints defined in this section on the use of XML Signature and
              the processing model with respect to signatures whose ds:Signature element appears as a 
              child of a wsse:Security element. This section of the profile places no constraints on ds:Signature elements appearing elsewhere. </p><p>This section of the Profile incorporates the following
		specifications by reference, and defines extensibility points within
		them:</p><ul><li><a href="http://www.w3.org/TR/xmldsig-core/">XML-Signature Syntax and Processing</a><br />Extensibility points:
			<ul><li><span class="statement-id"><a name="E0003">E0003</a></span> - CanonicalizationMethod Algorithm - Additional canonicalization algorithms may be specified.</li><li><span class="statement-id"><a name="E0004">E0004</a></span> - Transform Algorithm - Additional transform algorithms may be specified.</li><li><span class="statement-id"><a name="E0005">E0005</a></span> - DigestMethod Algorithm - Additional digest algorithms may be specified.</li><li><span class="statement-id"><a name="E0006">E0006</a></span> - SignatureMethod Algorithm - Additional signature algorithms may be specified.</li><li><span class="statement-id"><a name="E0007">E0007</a></span> - RetrievalMethod - Additional retrieval methods may be specified.</li></ul></li></ul><h3><a name="xmlSignatureGeneral">8.1</a> General Constraints on XML Signature</h3><div class="refinement"><h4 id="XSLTrefinement120122132121121120">8.1.1 Types of Signatures</h4><div class="rationale"><p>
                        Due to the nature of the SOAP processing model,
                        which is based on recognising the elements that are children of soap:Header and/or soap:Body
                        use of enveloping signatures, where the signed XML is encapsulated in a ds:Signature element,
                        is inappropriate. 
                        Enveloped signatures, where the ds:Signature element is a descendant of the signed element,
                        limit the ability of intermediaries to process messages and should be avoided unless said
                        limitation is the desired effect.
                    </p></div><p class="statement"><span class="statement-id"><a name="R3102">R3102</a></span> 
                        XML Signatures in a SECURE_ENVELOPE MUST NOT be Enveloping Signatures as defined by the XML Signature specification.
                    </p><p class="statement"><span class="statement-id"><a name="R3103">R3103</a></span> 
                        XML Signatures in a SECURE_ENVELOPE SHOULD be Detached Signatures as defined by the XML Signature specification.
                    </p><div class="explanation"><p>
                      Detached signatures are encouraged.
                      Enveloped signatures are discouraged.
                      Enveloping signatures are not allowed.
                    </p></div><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it contains an enveloping signature around the SomeSecurityToken element --&gt;

&lt;soap:Envelope xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
               xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature Id='TheSig' xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#' PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI='#SigPropBody'&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#' PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;i3qi5GjhHnfoBn/jOjQp2mq0Na4=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;oxNwoqGbzqg1YBliz+PProgcjw8=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
        &lt;ds:Object&gt;
          &lt;ds:SignatureProperties&gt;
            &lt;ds:SignatureProperty Id='SigPropBody' Target='#TheSig'&gt;
              &lt;SomeSecurityToken/&gt;
            &lt;/ds:SignatureProperty&gt;
          &lt;/ds:SignatureProperties&gt;
        &lt;/ds:Object&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
 &lt;soap:Header&gt;
   &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                  xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
     &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                               ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
     &lt;/wsse:BinarySecurityToken&gt;
     &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
       &lt;ds:SignedInfo&gt;
         &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
           &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                     PrefixList='wsse soap' /&gt;
         &lt;/ds:CanonicalizationMethod&gt;
         &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
         &lt;ds:Reference URI='#TheBody'&gt;
           &lt;ds:Transforms&gt;
             &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
               &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                         PrefixList='' /&gt;
             &lt;/ds:Transform&gt;
           &lt;/ds:Transforms&gt;
           &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
           &lt;ds:DigestValue&gt;i3qi5GjhHnfoBn/jOjQp2mq0Na4=&lt;/ds:DigestValue&gt;
         &lt;/ds:Reference&gt;
       &lt;/ds:SignedInfo&gt;
       &lt;ds:SignatureValue&gt;PipXJ2Sfc+LTDnq4pM5JcIYt9gg=&lt;/ds:SignatureValue&gt;
       &lt;ds:KeyInfo&gt;
         &lt;wsse:SecurityTokenReference&gt;
           &lt;wsse:Reference URI='#SomeCert' /&gt;
         &lt;/wsse:SecurityTokenReference&gt;
       &lt;/ds:KeyInfo&gt;
     &lt;/ds:Signature&gt;
   &lt;/wsse:Security&gt;
 &lt;/soap:Header&gt;
 &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
            wsu:Id='TheBody'&gt;
   &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
 &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div></div><h3><a name="WSSIDRef">8.2</a> Element References in XML Signature</h3><p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security Section 4</a></li></ul><p>Element references are used to specify which portions of a SECURE_ENVELOPE are integrity protected. This Profile places the following constraints on the use of Element References:</p><div class="refinement"><h4 id="XSLTrefinement122123132121121120">8.2.1 Reference to element with ID attribute</h4><div class="rationale"><p>
                      Local references using shorthand XPointers are easy to resolve.
                    </p></div><p class="statement"><span class="statement-id"><a name="R3001">R3001</a></span> 
                        When referring to an element in a SECURE_ENVELOPE that carries an attribute of type ID
                        from ds:Reference a shorthand XPointer MUST be used to refer to that
                        element.
                    </p><div class="explanation"><p>
                      This avoids requirement for receiver to implement generalized XPath processing when not required.
                    </p></div><p class="example-banner">For example,</p><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
 &lt;soap:Header&gt;
   &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                  xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
     &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                               ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
   &lt;/wsse:BinarySecurityToken&gt;
   &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
     &lt;ds:SignedInfo&gt;
       &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
         &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                   PrefixList='wsse soap' /&gt;
       &lt;/ds:CanonicalizationMethod&gt;
       &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
       &lt;ds:Reference URI='#TheBody'&gt;
         &lt;ds:Transforms&gt;
           &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
             &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                       PrefixList='' /&gt;
           &lt;/ds:Transform&gt;
         &lt;/ds:Transforms&gt;
         &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
         &lt;ds:DigestValue&gt;i3qi5GjhHnfoBn/jOjQp2mq0Na4=&lt;/ds:DigestValue&gt;
       &lt;/ds:Reference&gt;
     &lt;/ds:SignedInfo&gt;
     &lt;ds:SignatureValue&gt;PipXJ2Sfc+LTDnq4pM5JcIYt9gg=&lt;/ds:SignatureValue&gt;
     &lt;ds:KeyInfo&gt;
       &lt;wsse:SecurityTokenReference&gt;
         &lt;wsse:Reference URI='#SomeCert' /&gt;
       &lt;/wsse:SecurityTokenReference&gt;
     &lt;/ds:KeyInfo&gt;
   &lt;/ds:Signature&gt;
 &lt;/wsse:Security&gt;
&lt;/soap:Header&gt;
&lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
           wsu:Id='TheBody'&gt;
  &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement123123132121121120">8.2.2 Reference to element without ID attribute</h4><div class="rationale"><p>
                      Elements that do not have an attribute of type ID cannot be refered to by shorthand XPointers so a different referencing mechanism is needed. The XPath Filter 2.0 transform is more efficient that the original XPath transform from XML Digital Signature Syntax and Processing
                    </p></div><p class="statement"><span class="statement-id"><a name="R3002">R3002</a></span> 
                        When referring to an element in a SECURE_ENVELOPE that does NOT carry an attribute of
                        type ID from ds:Reference the XPath Filter 2.0 transform
                        (http://www.w3.org/2002/06/xmldsig-filter2) MUST be used to refer to
                        that element.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it uses the http://www.w3.org/TR/1999/REC-xpath-19991116 transform --&gt;

&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
 &lt;soap:Header&gt;
   &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                  xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
     &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                               ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
     &lt;/wsse:BinarySecurityToken&gt;
     &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
       &lt;ds:SignedInfo&gt;
         &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
           &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                     PrefixList='wsse soap' /&gt;
         &lt;/ds:CanonicalizationMethod&gt;
         &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
         &lt;ds:Reference URI=''&gt;
           &lt;ds:Transforms&gt;
             &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
               &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                         PrefixList='soap' /&gt;
             &lt;/ds:Transform&gt;
             &lt;ds:Transform Algorithm='http://www.w3.org/TR/1999/REC-xpath-19991116'&gt;
               &lt;ds:XPath&gt;/soap:Envelope/soap:Body/*&lt;/ds:XPath&gt;
             &lt;/ds:Transform&gt;
           &lt;/ds:Transforms&gt;
           &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
           &lt;ds:DigestValue&gt;VEPKwzfPGOxh2OUpoK0bcl58jtU=&lt;/ds:DigestValue&gt;
         &lt;/ds:Reference&gt;
       &lt;/ds:SignedInfo&gt;
       &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
       &lt;ds:KeyInfo&gt;
         &lt;wsse:SecurityTokenReference&gt;
           &lt;wsse:Reference URI='#SomeCert' /&gt;
         &lt;/wsse:SecurityTokenReference&gt;
       &lt;/ds:KeyInfo&gt;
     &lt;/ds:Signature&gt;
   &lt;/wsse:Security&gt;
 &lt;/soap:Header&gt;
 &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
            wsu:Id='TheBody'&gt;
   &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
 &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI=''&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='soap' /&gt;
              &lt;/ds:Transform&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2002/06/xmldsig-filter2'
                            xmlns:dsxp='http://www.w3.org/2002/06/xmldsig-filter2'&gt;
                &lt;dsxp:XPath Filter='intersect'&gt;/soap:Envelope/soap:Body/*&lt;/dsxp:XPath&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;VEPKwzfPGOxh2OUpoK0bcl58jtU=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div></div><h3><a name="xmlSignatureAlgorithms">8.3</a> XML Signature Algorithms</h3><div class="refinement"><h4 id="XSLTrefinement120124132121121120">8.3.1 Use Exclusive C14N</h4><div class="rationale"><p>
                    The use of Exclusive Canonicalization with c14n:InclusiveNamespaces/@Prefix addresses problems with both Inclusive Canonicalization and Exclusive Canonicalization without c14n:InclusiveNamespaces/@Prefix.
                  </p></div><p class="statement"><span class="statement-id"><a name="R5404">R5404</a></span> 
                      Any ds:CanonicalizationMethod/@Algorithm attribute in a SECURE_ENVELOPE MUST have a value of "http://www.w3.org/2001/10/xml-exc-c14n#" indicating that is uses Exclusive C14N without comments for canonicalization.
                    </p><p class="statement"><span class="statement-id"><a name="R5406">R5406</a></span> 
                      Any ds:CanonicalizationMethod element that has an @Algorithm attribute whose value is "http://www.w3.org/2001/10/xml-exc-c14n#" MUST have a c14N:InclusiveNamespace child element with an @PrefixList attribute.
                    </p><p class="statement"><span class="statement-id"><a name="R5407">R5407</a></span> 
                      Any ds:Transform element that has an @Algorithm attribute whose value is "http://www.w3.org/2001/10/xml-exc-c14n#" MUST have a c14N:InclusiveNamespace child element with an @PrefixList attribute.
                    </p><p class="statement"><span class="statement-id"><a name="R5405">R5405</a></span> 
                    Any ds:Transform/c14n:InclusiveNamespaces/@PrefixList attribute MUST contain the prefix of all in-scope namespaces for the element being signed that are not visibly utilized, per Exclusive XML Canonicalization Version 1.0.
                  </p><p class="statement"><span class="statement-id"><a name="R5408">R5408</a></span> 
                    Any ds:Transform/c14n:InclusiveNamespaces/@PrefixList attribute MUST contain the string "#default" if a default namespace is in-scope for the element being signed but is not visibly utilized, per Exclusive XML Canonicalization Version 1.0.
                  </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because it uses the http://www.w3.org/TR/2001/REC-xml-c14n-20010315 canonicalization algorithm --&gt;

&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/TR/2001/REC-xml-c14n-20010315' /&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI=''&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/TR/2001/REC-xml-c14n-20010315 ' /&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2002/06/xmldsig-filter2'
                            xmlns:dsxp='http://www.w3.org/2002/06/xmldsig-filter2'&gt;
                &lt;dsxp:XPath Filter='intersect'&gt;/soap:Envelope/soap:Body/*&lt;/dsxp:XPath&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;VEPKwzfPGOxh2OUpoK0bcl58jtU=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the ds:CanonicalizationMethod elements are missing a c14n:InclusiveNamespaces child element --&gt;

&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" ' /&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI=''&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#' /&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2002/06/xmldsig-filter2'
                            xmlns:dsxp='http://www.w3.org/2002/06/xmldsig-filter2'&gt;
                &lt;dsxp:XPath Filter='intersect'&gt;/soap:Envelope/soap:Body/*&lt;/dsxp:XPath&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;VEPKwzfPGOxh2OUpoK0bcl58jtU=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the PrefixList of the first c14n:InclusiveNamespaces element does not contain the 
     correct list of prefixes. It should contain the wsu prefix in addition to the wsse prefix. --&gt;

&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI=''&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2002/06/xmldsig-filter2'
                            xmlns:dsxp='http://www.w3.org/2002/06/xmldsig-filter2'&gt;
                &lt;dsxp:XPath Filter='intersect'&gt;/soap:Envelope/soap:Body/*&lt;/dsxp:XPath&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;VEPKwzfPGOxh2OUpoK0bcl58jtU=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI=''&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='soap' /&gt;
              &lt;/ds:Transform&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2002/06/xmldsig-filter2'
                            xmlns:dsxp='http://www.w3.org/2002/06/xmldsig-filter2'&gt;
                &lt;dsxp:XPath Filter='intersect'&gt;/soap:Envelope/soap:Body/*&lt;/dsxp:XPath&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;VEPKwzfPGOxh2OUpoK0bcl58jtU=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement121124132121121120">8.3.2 Transform required</h4><div class="rationale"><p>
                    Canonicalization is critical to ensuring signatures are processed correctly, thus each ds:Reference will need at least one ds:Transform to specify the Exclusive Canonicalization transform or a transform which toself encompasses canonicalization.
                  </p></div><p class="statement"><span class="statement-id"><a name="R5410">R5410</a></span> 
                    Any ds:Reference element in a SECURE_ENVELOPE MUST have a ds:Transforms child element.
                  </p><p class="statement"><span class="statement-id"><a name="R5411">R5411</a></span> 
                    Any ds:Transforms element in a SECURE_ENVELOPE MUST have at least one ds:Transform child element.
                  </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the ds:Reference element does not have a ds:Transforms child element --&gt;

&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;VEPKwzfPGOxh2OUpoK0bcl58jtU=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;+VTJraRYFT3pl7Z4uAWhmr5+bf4=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement122124132121121120">8.3.3 Permitted algorithms</h4><div class="rationale"><p>
                    These algorithms are chosen for their cryptographic strength,
                    utility or because they address some security concern.
                  </p></div><p class="statement"><span class="statement-id"><a name="R5420">R5420</a></span> 
                    Any ds:DigestMethod/@Algorithm element in a SECURE_ENVELOPE MUST have the value "http://www.w3.org/2000/09/xmldsig#sha1"
                  </p><p class="statement"><span class="statement-id"><a name="R5421">R5421</a></span> 
                    Any ds:SignatureMethod/@Algorithm element in a SECURE_ENVELOPE that is part of a signature based on a symmetric key MUST have the value "http://www.w3.org/2000/09/xmldsig#hmac-sha1"
                  </p><p class="statement"><span class="statement-id"><a name="R5422">R5422</a></span> 
                    Any ds:SignatureMethod/@Algorithm element in a SECURE_ENVELOPE that is part of a signature based on an asymmetric key MUST have the value "http://www.w3.org/2000/09/xmldsig#rsa-sha1"
                  </p><p class="statement"><span class="statement-id"><a name="R5423">R5423</a></span> 
                    Any ds:Transform/@Algorithm attribute in a SECURE_ENVELOPE MUST have a value
                    of "http://www.w3.org/2001/10/xml-exc-c14n#"
                    or "http://www.w3.org/2002/06/xmldsig-filter2"
                    or "http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#STRTransform"
                    or "http://www.w3.org/2000/09/xmldsig#enveloped-signature"
                  </p><p class="example-banner">For example,</p><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;xenc:EncryptedKey Id='Secret' xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' &gt;
        &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
        &lt;ds:KeyInfo xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
        &lt;xenc:CipherData&gt;
          &lt;xenc:CipherValue&gt;
            XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
          &lt;/xenc:CipherValue&gt;
        &lt;/xenc:CipherData&gt;
      &lt;/xenc:EncryptedKey&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#hmac-sha1' /&gt;
          &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;+VTJraRYFT3pl7Z4uAWhmr5+bf4=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#Secret' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;+VTJraRYFT3pl7Z4uAWhmr5+bf4=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div></div><h3><a name="xmlSignatureSyntax">8.4</a> XML Signature Syntax</h3><p>XML-Signature Syntax and Processing defines many elements and attributes.
                    This Profile places the following constraints on the syntax of signatures:</p><div class="refinement"><h4 id="XSLTrefinement121125132121121120">8.4.1 ds:HMACOutputLength</h4><div class="rationale"><p>
                      The ds:HMACOutputLength provides an input parameter to the HMAC-SHA1 algorithm specifying how many bits of the output to use.    Disallowing use of this element results in ALL the bits of the output being used.
                    </p></div><p class="statement"><span class="statement-id"><a name="R5401">R5401</a></span> 
                      The ds:HMACOutputLength element MUST NOT appear in a signature in a SECURE_ENVELOPE.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the ds:SignatureMethod element has a ds:HMACOutputLength child element --&gt;

&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
 &lt;soap:Header&gt;
   &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                  xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
     &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                               ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
     &lt;/wsse:BinarySecurityToken&gt;
     &lt;xenc:EncryptedKey Id='Secret'
                        xmlns:xenc='http://www.w3.org/2001/04/xmlenc#'&gt;
       &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
       &lt;ds:KeyInfo xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
         &lt;wsse:SecurityTokenReference&gt;
           &lt;wsse:Reference URI='#SomeCert' /&gt;
         &lt;/wsse:SecurityTokenReference&gt;
       &lt;/ds:KeyInfo&gt;
       &lt;xenc:CipherData&gt;
         &lt;xenc:CipherValue&gt;
           XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
         &lt;/xenc:CipherValue&gt;
       &lt;/xenc:CipherData&gt;
     &lt;/xenc:EncryptedKey&gt;
     &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
       &lt;ds:SignedInfo&gt;
         &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
           &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                     PrefixList='wsse soap' /&gt;
         &lt;/ds:CanonicalizationMethod&gt;
         &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#hmac-sha1'&gt;
           &lt;ds:HMACOutputLength&gt;128&lt;/ds:HMACOutputLength&gt;
         &lt;/ds:SignatureMethod&gt;
         &lt;ds:Reference URI='#TheBody'&gt;
           &lt;ds:Transforms&gt;
             &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
               &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                         PrefixList='' /&gt;
             &lt;/ds:Transform&gt;
           &lt;/ds:Transforms&gt;
           &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
           &lt;ds:DigestValue&gt;+VTJraRYFT3pl7Z4uAWhmr5+bf4=&lt;/ds:DigestValue&gt;
         &lt;/ds:Reference&gt;
       &lt;/ds:SignedInfo&gt;
       &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
       &lt;ds:KeyInfo&gt;
         &lt;wsse:SecurityTokenReference&gt;
           &lt;wsse:Reference URI='#Secret' /&gt;
         &lt;/wsse:SecurityTokenReference&gt;
       &lt;/ds:KeyInfo&gt;
     &lt;/ds:Signature&gt;
   &lt;/wsse:Security&gt;
 &lt;/soap:Header&gt;
 &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
            wsu:Id='TheBody'&gt;
   &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
 &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;xenc:EncryptedKey Id='Secret' xmlns:xenc='http://www.w3.org/2001/04/xmlenc#'&gt;
        &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
        &lt;ds:KeyInfo xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
        &lt;xenc:CipherData&gt;
          &lt;xenc:CipherValue&gt;
            XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
          &lt;/xenc:CipherValue&gt;
        &lt;/xenc:CipherData&gt;
      &lt;/xenc:EncryptedKey&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#hmac-sha1' /&gt;
          &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;+VTJraRYFT3pl7Z4uAWhmr5+bf4=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#Secret' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement122125132121121120">8.4.2 ds:KeyInfo</h4><div class="rationale"><p>
                    The ds:KeyInfo element allows for many different child elements. This profile mandates a single element and restricts the list to wsse:SecurityTokenReference, which is needed to reference security tokens, and ds:MgmtData, which is needed to include inline unencrypted key info. The latter would only be used when tranmission occurs over a secure transport.
                    </p></div><p class="statement"><span class="statement-id"><a name="R5402">R5402</a></span> 
                    A ds:KeyInfo element in a SECURE_ENVELOPE MUST have exactly one child element.
                  </p><p class="statement"><span class="statement-id"><a name="R5409">R5409</a></span> 
                    The child element of a ds:KeyInfo element in a SECURE_ENVELOPE MUST be either wsse:SecurityTokenReference or ds:MgmtData.
                  </p><p class="example-banner">For example,</p><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;xenc:EncryptedKey Id='Secret' xmlns:xenc='http://www.w3.org/2001/04/xmlenc#'&gt;
        &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
        &lt;ds:KeyInfo xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
        &lt;xenc:CipherData&gt;
          &lt;xenc:CipherValue&gt;
            XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
          &lt;/xenc:CipherValue&gt;
        &lt;/xenc:CipherData&gt;
      &lt;/xenc:EncryptedKey&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#hmac-sha1' /&gt;
          &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;+VTJraRYFT3pl7Z4uAWhmr5+bf4=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#Secret' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#hmac-sha1' /&gt;
          &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;+VTJraRYFT3pl7Z4uAWhmr5+bf4=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;ds:MgmtData&gt;eMtKYL5PbZ59pu/zKtFkwQod0kA=&lt;/ds:MgmtData&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement123125132121121120">8.4.3 ds:Manifest</h4><div class="rationale"><p>The ds:Manifest element is designed for specific application level use cases that do not apply to the use of XML Signature in SOAP Message Security.</p></div><p class="statement"><span class="statement-id"><a name="R5403">R5403</a></span> 
                        A ds:Signature element in a SECURE_ENVELOPE MUST NOT contain a ds:Manifest element.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the ds:Signature element has a ds:Manifest grandchild element --&gt;

&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI='#TheManifest'&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;OVuYKGY6KCGB0l0XHS3krj8vjek=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;L7X0Zw23/zYQnX4+Z+p0gCygKQ0=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
        &lt;ds:Object&gt;
          &lt;ds:Manifest Id='TheManifest'&gt;
            &lt;ds:Reference URI='#TheBody'&gt;
              &lt;ds:Transforms&gt;
                &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                  &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                            PrefixList='' /&gt;
                &lt;/ds:Transform&gt;
              &lt;/ds:Transforms&gt;
              &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
              &lt;ds:DigestValue&gt;+VTJraRYFT3pl7Z4uAWhmr5+bf4=&lt;/ds:DigestValue&gt;
            &lt;/ds:Reference&gt;
          &lt;/ds:Manifest&gt;
        &lt;/ds:Object&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope' &gt;
  &lt;soap:Header&gt;
    &lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
                   xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;
      &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                                ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
      &lt;/wsse:BinarySecurityToken&gt;
      &lt;ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'&gt;
        &lt;ds:SignedInfo&gt;
          &lt;ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#" '&gt;
            &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                      PrefixList='wsse soap' /&gt;
          &lt;/ds:CanonicalizationMethod&gt;
          &lt;ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /&gt;
          &lt;ds:Reference URI='#TheBody'&gt;
            &lt;ds:Transforms&gt;
              &lt;ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#'&gt;
                &lt;c14n:InclusiveNamespaces xmlns:c14n='http://www.w3.org/2001/10/xml-exc-c14n#'
                                          PrefixList='' /&gt;
              &lt;/ds:Transform&gt;
            &lt;/ds:Transforms&gt;
            &lt;ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /&gt;
            &lt;ds:DigestValue&gt;+VTJraRYFT3pl7Z4uAWhmr5+bf4=&lt;/ds:DigestValue&gt;
          &lt;/ds:Reference&gt;
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;+diIuEyDpV7qxVoUOkb5rj61+Zs=&lt;/ds:SignatureValue&gt;
        &lt;ds:KeyInfo&gt;
          &lt;wsse:SecurityTokenReference&gt;
            &lt;wsse:Reference URI='#SomeCert' /&gt;
          &lt;/wsse:SecurityTokenReference&gt;
        &lt;/ds:KeyInfo&gt;
      &lt;/ds:Signature&gt;
    &lt;/wsse:Security&gt;
  &lt;/soap:Header&gt;
  &lt;soap:Body xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
             wsu:Id='TheBody'&gt;
    &lt;m:SomeElement xmlns:m='http://example.org/ws' /&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre></div></div><h3><a name="xmlSignatureConsiderations">8.5</a> Security Considerations</h3><div class="refinement"><h4 id="XSLTrefinement120126132121121120">8.5.1 Sign Security Token</h4><p class="statement"><span class="statement-id"><a name="C5440">C5440</a></span> 
                        A ds:Signature in a SECURE_ENVELOPE which contains the Security Token which provides                        the signature verification key SHOULD include a ds:Reference which points to that                        Security Token in order to prevent substitution with another Security Token that uses
                        the same key.
                    </p><p class="statement"><span class="statement-id"><a name="C5441">C5441</a></span> 
                        A ds:Signature in a SECURE_ENVELOPE which does not contain the Security Token which                        provides the signature verification key SHOULD include a ds:Reference that uses the                        Security Token Dereferencing Transform that points to the wsse:SecurityTokenReference                        that refers to that Security Token in order to prevent substitution of another Security
                        Token that uses the same key.
                    </p></div><h2><a name="xmlEncryption">9. </a>XML Encryption</h2><p>Web Services Security: SOAP Message Security builds on XML Encryption,
              defining usage of various elements from XML Encryption and a processing model.
              This Profile places the constraints defined in this section on the use of XML Encryption and
              the processing model with respect to xenc:EncryptedData, xenc:EncryptedKey and xenc:ReferenceList elements that are the result of or are used as part of performing a single encryption step ( as defined in SOAP Message Security ). This section of the profile places no constraints on xenc:EncryptedData, xenc:EncryptedKey and xenc:ReferenceList elements produced by or used for other purposes. </p><p>This section of the Profile incorporates the following
		specifications by reference, and defines extensibility points within
		them:</p><ul><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security Section 9</a></li><li><a href="http://www.w3.org/TR/xmlenc-core/">XML Encryption Syntax and Processing</a><br />Extensibility points:
			<ul><li><span class="statement-id"><a name="E0008">E0008</a></span> - Encryption Algorithm - Additional encryption algorithms may be specified.</li></ul></li></ul><h3><a name="xmlEncryptProcessing">9.1</a> XML Encryption Processing Model</h3><div class="refinement"><h4 id="XSLTrefinement120122134121121120">9.1.1 xenc:ReferenceList</h4><div class="rationale"><p>Some encryption steps might not produce an xenc:ReferenceList. For those that do produce an xenc:ReferenceList, there must be a seperate xenc:ReferenceList for each such encryption step. When there is a xenc:ReferenceList either as a child of wsse:Security or as a child of xenc:EncryptedKey it must list all the corresponding xenc:EncryptedData elements by using xenc:DataReference elements.</p></div><p class="statement"><span class="statement-id"><a name="R3205">R3205</a></span> 
                    For each encryption step that produces an xenc:ReferenceList a SECURE_ENVELOPE MUST contain a seperate wsse:Security/xenc:ReferenceList element for each key used in that encryption step.
                  </p><p class="statement"><span class="statement-id"><a name="R3215">R3215</a></span> 
                    Any xenc:ReferenceList in a SECURE_ENVELOPE MUST contain an xenc:DataReference element for each xenc:EncryptedData element encrypted under a single key as part of the corresponding encryption step.
                  </p><p class="statement"><span class="statement-id"><a name="R3214">R3214</a></span> 
                    An xenc:ReferenceList element in a SECURE_ENVELOPE which is a child of xenc:EncryptedKey MUST contain a xenc:DataReference for each xenc:EncryptedData element that was encrypted in the encryption step with the key corresponding to the xenc:EncryptedKey.
                    </p></div><div class="refinement"><h4 id="XSLTrefinement121122134121121120">9.1.2 xenc:EncryptedKey</h4><div class="rationale"><p>To facilitate ease of processing, keys are required to appear inside wsse:Security headers and to appear before they are required for decryption of elements inside a wsse:Security header.</p></div><p class="statement"><span class="statement-id"><a name="R3207">R3207</a></span> 
                      All xenc:EncryptedKey elements in a SECURE_ENVELOPE that are intended for use by SOAP Message Security MUST be children of a wsse:Security header.
                    </p><p class="statement"><span class="statement-id"><a name="R3208">R3208</a></span> 
                    xenc:EncryptedKey elements in the wsse:Security header in a SECURE_ENVELOPE MUST precede any xenc:EncryptedData    elements in that header encrypted using the key in the xenc:EncryptedKey element.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
  &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
  &lt;/wsse:BinarySecurityToken&gt;
  &lt;xenc:EncryptedData Id='Enc1'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#tripledes-cbc' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#Secret' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
9jFtYcLSlDZQBMjKfT7ctg6Jy+6sC8YORhiPeTvOjug7ozY2SRHGuLt8G/vf2f/f4IdF0ewiDOpq
XhuqQhv7gnbfj9kHpmz8whIzL/DLLmwZsJi0iL38GJZMy+r2HHWfgZmF/0ol2DoaSQ/Z7936nzCu
kJKCR/m443dDutuBBaWck65WRi4i9NhemT+uIii5Uiu6SIziHTqfzBvT4h1emUNpPVwvo1kBi5u6
I626CsFOiWivx7wZuXZzt3oTTxK7/wD7ROXMiq7Rub3wKPmM5cFahFi0r9GGT4Pmu+vf7juJ/yOt
vsXcgf+53Q3/KJF85tK4ucu5BlAudPRh5s7C8suBZyjV3yb7fQJZ+tHEhyfxadQZJjVwz/jTf0nR
epsw9utCfcFopgervTvIYAx/au3NcHz5qcuVEZcwAmDcKgJnKQPlgQllicLNbmn5qG/sVBVbAwoe
Nk0grWwqOKSnzpM5YTcImejkaOa6LDphnGknQ65KgSb3SPK1xNSdO1AeJZ/VwEc45Losd5sjZAkT
vhADAvX2XE1sQRhEUtQURy2Wmwabi9sh71/zHgmL0+ToogXDmThbKMlSaX4u85HlFzBujcgDeDM0
4ROWAj1D4W40W7DPUa30O3M9SSJd8/vODgfZHUYb5SrSjrgkxSaLDogQ+pfgFsWCeVJVxS4Q1+4=
   &lt;/xenc:CipherValue&gt;
 &lt;/xenc:CipherData&gt;
&lt;/xenc:EncryptedData&gt;
&lt;xenc:EncryptedKey Id='Secret'&gt;
  &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
  &lt;ds:KeyInfo&gt;
    &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Reference URI='#SomeCert' /&gt;
    &lt;/wsse:SecurityTokenReference&gt;
  &lt;/ds:KeyInfo&gt;
  &lt;xenc:CipherData&gt;
    &lt;xenc:CipherValue&gt;
      XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=
    &lt;/xenc:CipherValue&gt;
    &lt;xenc:ReferenceList&gt;
      &lt;xenc:DataReference URI='#Enc1' /&gt;
    &lt;/xenc:ReferenceList&gt;
  &lt;/xenc:CipherData&gt;
&lt;/xenc:EncryptedKey&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
  &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
  &lt;/wsse:BinarySecurityToken&gt;
  &lt;xenc:EncryptedKey Id='Secret'&gt;
   &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
   &lt;ds:KeyInfo&gt;
     &lt;wsse:SecurityTokenReference&gt;
       &lt;wsse:Reference URI='#SomeCert' /&gt;
     &lt;/wsse:SecurityTokenReference&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;xenc:CipherData&gt;
     &lt;xenc:CipherValue&gt;
       XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
     &lt;/xenc:CipherValue&gt;
   &lt;/xenc:CipherData&gt;
   &lt;xenc:ReferenceList&gt;
     &lt;xenc:DataReference URI='#Enc1' /&gt;
   &lt;/xenc:ReferenceList&gt;
  &lt;/xenc:EncryptedKey&gt;
  &lt;xenc:EncryptedData Id='Enc1'&gt;
   &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#tripledes-cbc' /&gt;
   &lt;ds:KeyInfo&gt;
     &lt;wsse:SecurityTokenReference&gt;
       &lt;wsse:Reference URI='#Secret' /&gt;
     &lt;/wsse:SecurityTokenReference&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;xenc:CipherData&gt;
     &lt;xenc:CipherValue&gt;
9jFtYcLSlDZQBMjKfT7ctg6Jy+6sC8YORhiPeTvOjug7ozY2SRHGuLt8G/vf2f/f4IdF0ewiDOpq
XhuqQhv7gnbfj9kHpmz8whIzL/DLLmwZsJi0iL38GJZMy+r2HHWfgZmF/0ol2DoaSQ/Z7936nzCu
kJKCR/m443dDutuBBaWck65WRi4i9NhemT+uIii5Uiu6SIziHTqfzBvT4h1emUNpPVwvo1kBi5u6
I626CsFOiWivx7wZuXZzt3oTTxK7/wD7ROXMiq7Rub3wKPmM5cFahFi0r9GGT4Pmu+vf7juJ/yOt
vsXcgf+53Q3/KJF85tK4ucu5BlAudPRh5s7C8suBZyjV3yb7fQJZ+tHEhyfxadQZJjVwz/jTf0nR
epsw9utCfcFopgervTvIYAx/au3NcHz5qcuVEZcwAmDcKgJnKQPlgQllicLNbmn5qG/sVBVbAwoe
Nk0grWwqOKSnzpM5YTcImejkaOa6LDphnGknQ65KgSb3SPK1xNSdO1AeJZ/VwEc45Losd5sjZAkT
vhADAvX2XE1sQRhEUtQURy2Wmwabi9sh71/zHgmL0+ToogXDmThbKMlSaX4u85HlFzBujcgDeDM0
4ROWAj1D4W40W7DPUa30O3M9SSJd8/vODgfZHUYb5SrSjrgkxSaLDogQ+pfgFsWCeVJVxS4Q1+4=
     &lt;/xenc:CipherValue&gt;
   &lt;/xenc:CipherData&gt;
  &lt;/xenc:EncryptedData&gt;
&lt;/wsse:Security&gt;
</pre></div></div><h3><a name="xmlEncryptionKeys">9.2</a> XML Encryption Syntax</h3><p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p><ul><li><a href="http://www.w3.org/TR/xmlenc-core/">XML Encryption Syntax and Processing</a></li></ul><p>XML Encryption Syntax and Processing defines many elements and attributes. This Profile places the following constraints on their use:</p><div class="refinement"><h4 id="XSLTrefinement122123134121121120">9.2.1 Placement</h4><p class="statement"><span class="statement-id"><a name="R3216">R3216</a></span> 
                    Any xenc:EncryptedKey element MUST contain a xenc:ReferenceList child element.
                  </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the xenc:EncryptedKey element is missing an xenc:ReferenceList child element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
  &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
  &lt;/wsse:BinarySecurityToken&gt;
  &lt;xenc:EncryptedKey Id='Secret'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#SomeCert' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
        XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
  &lt;/xenc:EncryptedKey&gt;
  &lt;xenc:ReferenceList&gt;
    &lt;xenc:DataReference URI='#Enc1' /&gt;
  &lt;/xenc:ReferenceList&gt;
  &lt;xenc:EncryptedData Id='Enc1'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#tripledes-cbc' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#Secret' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
9jFtYcLSlDZQBMjKfT7ctg6Jy+6sC8YORhiPeTvOjug7ozY2SRHGuLt8G/vf2f/f4IdF0ewiDOpq
XhuqQhv7gnbfj9kHpmz8whIzL/DLLmwZsJi0iL38GJZMy+r2HHWfgZmF/0ol2DoaSQ/Z7936nzCu
kJKCR/m443dDutuBBaWck65WRi4i9NhemT+uIii5Uiu6SIziHTqfzBvT4h1emUNpPVwvo1kBi5u6
I626CsFOiWivx7wZuXZzt3oTTxK7/wD7ROXMiq7Rub3wKPmM5cFahFi0r9GGT4Pmu+vf7juJ/yOt
vsXcgf+53Q3/KJF85tK4ucu5BlAudPRh5s7C8suBZyjV3yb7fQJZ+tHEhyfxadQZJjVwz/jTf0nR
epsw9utCfcFopgervTvIYAx/au3NcHz5qcuVEZcwAmDcKgJnKQPlgQllicLNbmn5qG/sVBVbAwoe
Nk0grWwqOKSnzpM5YTcImejkaOa6LDphnGknQ65KgSb3SPK1xNSdO1AeJZ/VwEc45Losd5sjZAkT
vhADAvX2XE1sQRhEUtQURy2Wmwabi9sh71/zHgmL0+ToogXDmThbKMlSaX4u85HlFzBujcgDeDM0
4ROWAj1D4W40W7DPUa30O3M9SSJd8/vODgfZHUYb5SrSjrgkxSaLDogQ+pfgFsWCeVJVxS4Q1+4=
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
  &lt;/xenc:EncryptedData&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
  &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
  &lt;/wsse:BinarySecurityToken&gt;
  &lt;xenc:EncryptedKey Id='Secret'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#SomeCert' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
        XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
    &lt;xenc:ReferenceList&gt;
      &lt;xenc:DataReference URI='#Enc1' /&gt;
    &lt;/xenc:ReferenceList&gt;
  &lt;/xenc:EncryptedKey&gt;
  &lt;xenc:EncryptedData Id='Enc1'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#tripledes-cbc' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#Secret' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
9jFtYcLSlDZQBMjKfT7ctg6Jy+6sC8YORhiPeTvOjug7ozY2SRHGuLt8G/vf2f/f4IdF0ewiDOpq
XhuqQhv7gnbfj9kHpmz8whIzL/DLLmwZsJi0iL38GJZMy+r2HHWfgZmF/0ol2DoaSQ/Z7936nzCu
kJKCR/m443dDutuBBaWck65WRi4i9NhemT+uIii5Uiu6SIziHTqfzBvT4h1emUNpPVwvo1kBi5u6
I626CsFOiWivx7wZuXZzt3oTTxK7/wD7ROXMiq7Rub3wKPmM5cFahFi0r9GGT4Pmu+vf7juJ/yOt
vsXcgf+53Q3/KJF85tK4ucu5BlAudPRh5s7C8suBZyjV3yb7fQJZ+tHEhyfxadQZJjVwz/jTf0nR
epsw9utCfcFopgervTvIYAx/au3NcHz5qcuVEZcwAmDcKgJnKQPlgQllicLNbmn5qG/sVBVbAwoe
Nk0grWwqOKSnzpM5YTcImejkaOa6LDphnGknQ65KgSb3SPK1xNSdO1AeJZ/VwEc45Losd5sjZAkT
vhADAvX2XE1sQRhEUtQURy2Wmwabi9sh71/zHgmL0+ToogXDmThbKMlSaX4u85HlFzBujcgDeDM0
4ROWAj1D4W40W7DPUa30O3M9SSJd8/vODgfZHUYb5SrSjrgkxSaLDogQ+pfgFsWCeVJVxS4Q1+4=
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
  &lt;/xenc:EncryptedData&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement123123134121121120">9.2.2 xenc:EncryptedKey attributes</h4><p class="statement"><span class="statement-id"><a name="R3209">R3209</a></span> 
                    xenc:EncryptedKey elements in a SECURE_ENVELOPE MUST NOT specify a Type attribute.
                    </p><p class="statement"><span class="statement-id"><a name="R5622">R5622</a></span> 
                    xenc:EncryptedKey elements in a SECURE_ENVELOPE MUST NOT specify a MimeType attribute.
                    </p><p class="statement"><span class="statement-id"><a name="R5623">R5623</a></span> 
                    xenc:EncryptedKey elements in a SECURE_ENVELOPE MUST NOT specify a Encoding attribute.
                    </p></div><div class="refinement"><h4 id="XSLTrefinement124123134121121120">9.2.3 xenc:EncryptedData attributes</h4><p class="statement"><span class="statement-id"><a name="R5624">R5624</a></span> 
                    xenc:EncryptedKey elements in a SECURE_ENVELOPE MUST have an Id attribute.
                    </p></div><div class="refinement"><h4 id="XSLTrefinement125123134121121120">9.2.4 References from xenc:EncryptedData</h4><p class="statement"><span class="statement-id"><a name="R3211">R3211</a></span> 
                    An xenc:EncryptedData/ds:KeyInfo/wsse:SecurityTokenReference element in a SECURE_ENVELOPE MUST NOT reference
                    another ds:KeyInfo element.
                    </p></div><div class="refinement"><h4 id="XSLTrefinement126123134121121120">9.2.5 xenc:EncryptionMethod mandatory</h4><div class="rationale"><p></p></div><p class="statement"><span class="statement-id"><a name="R5601">R5601</a></span> 
                      When an xenc:EncryptedData element appears in a SECURE_ENVELOPE it MUST have an xenc:EncryptionMethod child element.
                    </p><p class="statement"><span class="statement-id"><a name="R5603">R5603</a></span> 
                      When an xenc:EncryptedKey element appears in a SECURE_ENVELOPE it MUST have an xenc:EncryptionMethod child element.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the xenc:EncryptedKey element is missing an xenc:EncryptionMethod child element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
  &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
  &lt;/wsse:BinarySecurityToken&gt;
  &lt;xenc:EncryptedKey Id='Secret'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#SomeCert' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
        XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
    &lt;xenc:ReferenceList&gt;
      &lt;xenc:DataReference URI='#Enc1' /&gt;
    &lt;/xenc:ReferenceList&gt;
  &lt;/xenc:EncryptedKey&gt;
  &lt;xenc:EncryptedData Id='Enc1'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#tripledes-cbc' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#Secret' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
9jFtYcLSlDZQBMjKfT7ctg6Jy+6sC8YORhiPeTvOjug7ozY2SRHGuLt8G/vf2f/f4IdF0ewiDOpq
XhuqQhv7gnbfj9kHpmz8whIzL/DLLmwZsJi0iL38GJZMy+r2HHWfgZmF/0ol2DoaSQ/Z7936nzCu
kJKCR/m443dDutuBBaWck65WRi4i9NhemT+uIii5Uiu6SIziHTqfzBvT4h1emUNpPVwvo1kBi5u6
I626CsFOiWivx7wZuXZzt3oTTxK7/wD7ROXMiq7Rub3wKPmM5cFahFi0r9GGT4Pmu+vf7juJ/yOt
vsXcgf+53Q3/KJF85tK4ucu5BlAudPRh5s7C8suBZyjV3yb7fQJZ+tHEhyfxadQZJjVwz/jTf0nR
epsw9utCfcFopgervTvIYAx/au3NcHz5qcuVEZcwAmDcKgJnKQPlgQllicLNbmn5qG/sVBVbAwoe
Nk0grWwqOKSnzpM5YTcImejkaOa6LDphnGknQ65KgSb3SPK1xNSdO1AeJZ/VwEc45Losd5sjZAkT
vhADAvX2XE1sQRhEUtQURy2Wmwabi9sh71/zHgmL0+ToogXDmThbKMlSaX4u85HlFzBujcgDeDM0
4ROWAj1D4W40W7DPUa30O3M9SSJd8/vODgfZHUYb5SrSjrgkxSaLDogQ+pfgFsWCeVJVxS4Q1+4=
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
  &lt;/xenc:EncryptedData&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the xenc:EncryptedData element is missing an xenc:EncryptionMethod child element --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
  &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
  &lt;/wsse:BinarySecurityToken&gt;
  &lt;xenc:EncryptedKey Id='Secret'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#SomeCert' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
        XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
    &lt;xenc:ReferenceList&gt;
      &lt;xenc:DataReference URI='#Enc1' /&gt;
    &lt;/xenc:ReferenceList&gt;
  &lt;/xenc:EncryptedKey&gt;
  &lt;xenc:EncryptedData Id='Enc1'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#tripledes-cbc' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#Secret' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
9jFtYcLSlDZQBMjKfT7ctg6Jy+6sC8YORhiPeTvOjug7ozY2SRHGuLt8G/vf2f/f4IdF0ewiDOpq
XhuqQhv7gnbfj9kHpmz8whIzL/DLLmwZsJi0iL38GJZMy+r2HHWfgZmF/0ol2DoaSQ/Z7936nzCu
kJKCR/m443dDutuBBaWck65WRi4i9NhemT+uIii5Uiu6SIziHTqfzBvT4h1emUNpPVwvo1kBi5u6
I626CsFOiWivx7wZuXZzt3oTTxK7/wD7ROXMiq7Rub3wKPmM5cFahFi0r9GGT4Pmu+vf7juJ/yOt
vsXcgf+53Q3/KJF85tK4ucu5BlAudPRh5s7C8suBZyjV3yb7fQJZ+tHEhyfxadQZJjVwz/jTf0nR
epsw9utCfcFopgervTvIYAx/au3NcHz5qcuVEZcwAmDcKgJnKQPlgQllicLNbmn5qG/sVBVbAwoe
Nk0grWwqOKSnzpM5YTcImejkaOa6LDphnGknQ65KgSb3SPK1xNSdO1AeJZ/VwEc45Losd5sjZAkT
vhADAvX2XE1sQRhEUtQURy2Wmwabi9sh71/zHgmL0+ToogXDmThbKMlSaX4u85HlFzBujcgDeDM0
4ROWAj1D4W40W7DPUa30O3M9SSJd8/vODgfZHUYb5SrSjrgkxSaLDogQ+pfgFsWCeVJVxS4Q1+4=
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
  &lt;/xenc:EncryptedData&gt;
&lt;/wsse:Security&gt;
</pre></div><div class="example"><p class="correct">CORRECT: </p><pre>
&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
  &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
  &lt;/wsse:BinarySecurityToken&gt;
  &lt;xenc:EncryptedKey Id='Secret'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#SomeCert' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
        XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
    &lt;xenc:ReferenceList&gt;
      &lt;xenc:DataReference URI='#Enc1' /&gt;
    &lt;/xenc:ReferenceList&gt;
  &lt;/xenc:EncryptedKey&gt;
  &lt;xenc:EncryptedData Id='Enc1'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#tripledes-cbc' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#Secret' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
9jFtYcLSlDZQBMjKfT7ctg6Jy+6sC8YORhiPeTvOjug7ozY2SRHGuLt8G/vf2f/f4IdF0ewiDOpq
XhuqQhv7gnbfj9kHpmz8whIzL/DLLmwZsJi0iL38GJZMy+r2HHWfgZmF/0ol2DoaSQ/Z7936nzCu
kJKCR/m443dDutuBBaWck65WRi4i9NhemT+uIii5Uiu6SIziHTqfzBvT4h1emUNpPVwvo1kBi5u6
I626CsFOiWivx7wZuXZzt3oTTxK7/wD7ROXMiq7Rub3wKPmM5cFahFi0r9GGT4Pmu+vf7juJ/yOt
vsXcgf+53Q3/KJF85tK4ucu5BlAudPRh5s7C8suBZyjV3yb7fQJZ+tHEhyfxadQZJjVwz/jTf0nR
epsw9utCfcFopgervTvIYAx/au3NcHz5qcuVEZcwAmDcKgJnKQPlgQllicLNbmn5qG/sVBVbAwoe
Nk0grWwqOKSnzpM5YTcImejkaOa6LDphnGknQ65KgSb3SPK1xNSdO1AeJZ/VwEc45Losd5sjZAkT
vhADAvX2XE1sQRhEUtQURy2Wmwabi9sh71/zHgmL0+ToogXDmThbKMlSaX4u85HlFzBujcgDeDM0
4ROWAj1D4W40W7DPUa30O3M9SSJd8/vODgfZHUYb5SrSjrgkxSaLDogQ+pfgFsWCeVJVxS4Q1+4=
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
  &lt;/xenc:EncryptedData&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement127123134121121120">9.2.6 xenc:EncryptedKey/@Recipient</h4><div class="rationale"><p></p></div><p class="statement"><span class="statement-id"><a name="R5602">R5602</a></span> 
                      When an xenc:EncryptedKey appears in a SECURE_ENVELOPE, a Recipient attribute MUST NOT be present.
                    </p><p class="example-banner">For example,</p><div class="example"><p class="incorrect">INCORRECT: </p><pre>
&lt;!-- This example is incorrect because the xenc:EncryptedKey element has a Recipient attribute  --&gt;

&lt;wsse:Security xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'
               xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' 
               xmlns:xenc='http://www.w3.org/2001/04/xmlenc#' 
               xmlns:ds='http://www.w3.org/2000/09/xmldsig#' &gt;
  &lt;wsse:BinarySecurityToken wsu:Id='SomeCert'
                            ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
lui+Jy4WYKGJW5xM3aHnLxOpGVIpzSg4V486hHFe7sHET/uxxVBovT7JV1A2RnWSWkXm9jAEdsm/
hs+f3NwvK23bh46mNmnCQVsUYHbYAREZpykrd/eRwNgx8T+ByeFhmSviW77n6yTcI7XU7xZT54S9
hTSyBLN2Sce1dEQpQXh5ssZK9aZTMrsFT1NBvNHC3Qq7w0Otr5V4axH3MXffsuI9WzxPCfHdalN4
rLRfNY318pc6bn00zAMw0omUWwBEJZxxBGGUc9QY3VjwNALgGDaEAT7gpURkCI85HjdnSA5SM4cY
7jAsYX/CIpEkRJcBULlTEFrBZIBYDPzRWlSdsJRJngF7yCoGWJ+/HYOyP8P4OM59FDi0kM8GwOE0
WgYrJHH92qaVhoiPTLi7
  &lt;/wsse:BinarySecurityToken&gt;
  &lt;xenc:EncryptedKey Id='Secret' Recipient='Bert'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#SomeCert' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
        XZEEVABD3L9G+VNTCDiDTE7WB1a4kILtz5f9FT747eE=       
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
    &lt;xenc:ReferenceList&gt;
      &lt;xenc:DataReference URI='#Enc1' /&gt;
    &lt;/xenc:ReferenceList&gt;
  &lt;/xenc:EncryptedKey&gt;
  &lt;xenc:EncryptedData Id='Enc1'&gt;
    &lt;xenc:EncryptionMethod Algorithm='http://www.w3.org/2001/04/xmlenc#tripledes-cbc' /&gt;
    &lt;ds:KeyInfo&gt;
      &lt;wsse:SecurityTokenReference&gt;
        &lt;wsse:Reference URI='#Secret' /&gt;
      &lt;/wsse:SecurityTokenReference&gt;
    &lt;/ds:KeyInfo&gt;
    &lt;xenc:CipherData&gt;
      &lt;xenc:CipherValue&gt;
9jFtYcLSlDZQBMjKfT7ctg6Jy+6sC8YORhiPeTvOjug7ozY2SRHGuLt8G/vf2f/f4IdF0ewiDOpq
XhuqQhv7gnbfj9kHpmz8whIzL/DLLmwZsJi0iL38GJZMy+r2HHWfgZmF/0ol2DoaSQ/Z7936nzCu
kJKCR/m443dDutuBBaWck65WRi4i9NhemT+uIii5Uiu6SIziHTqfzBvT4h1emUNpPVwvo1kBi5u6
I626CsFOiWivx7wZuXZzt3oTTxK7/wD7ROXMiq7Rub3wKPmM5cFahFi0r9GGT4Pmu+vf7juJ/yOt
vsXcgf+53Q3/KJF85tK4ucu5BlAudPRh5s7C8suBZyjV3yb7fQJZ+tHEhyfxadQZJjVwz/jTf0nR
epsw9utCfcFopgervTvIYAx/au3NcHz5qcuVEZcwAmDcKgJnKQPlgQllicLNbmn5qG/sVBVbAwoe
Nk0grWwqOKSnzpM5YTcImejkaOa6LDphnGknQ65KgSb3SPK1xNSdO1AeJZ/VwEc45Losd5sjZAkT
vhADAvX2XE1sQRhEUtQURy2Wmwabi9sh71/zHgmL0+ToogXDmThbKMlSaX4u85HlFzBujcgDeDM0
4ROWAj1D4W40W7DPUa30O3M9SSJd8/vODgfZHUYb5SrSjrgkxSaLDogQ+pfgFsWCeVJVxS4Q1+4=
      &lt;/xenc:CipherValue&gt;
    &lt;/xenc:CipherData&gt;
  &lt;/xenc:EncryptedData&gt;
&lt;/wsse:Security&gt;
</pre></div></div><div class="refinement"><h4 id="XSLTrefinement128123134121121120">9.2.7 ds:KeyInfo/xenc:AgreementMethod prohibited</h4><p class="statement"><span class="statement-id"><a name="R5605">R5605</a></span> 
                    Any ds:KeyInfo elements in a SECURE_ENVELOPE MUST NOT have any xenc:AgreementMethod child elements.
                  </p></div><div class="refinement"><h4 id="XSLTrefinement129123134121121120">9.2.8 xenc:EncryptedData</h4><p class="statement"><span class="statement-id"><a name="R5606">R5606</a></span> 
                        Within a SECURE_ENVELOPE an encrypted element or element content MUST be replaced by a
                        corresponding xenc:EncryptedData.
                  </p></div><div class="refinement"><h4 id="XSLTrefinement130123134121121120">9.2.9 SOAP Envelope</h4><p class="statement"><span class="statement-id"><a name="R5607">R5607</a></span> 
                        When encryption is used, the SECURE_ENVELOPE MUST still be a valid SOAP envelope.
                        Specifically, the Envelope, Header, or Body elements MUST NOT be encrypted.
                  </p></div><h3><a name="xmlEncryptionAlgorithms">9.3</a> XML Encryption Algorithms</h3><div class="refinement"><h4 id="XSLTrefinement120124134121121120">9.3.1 Permitted Algorithms</h4><p class="statement"><span class="statement-id"><a name="R5620">R5620</a></span> 
                    Any xenc:EncryptedData/xenc:EncryptionMethod/@Algorithm attribute in a SECURE_ENVELOPE MUST have a value of "http://www.w3.org/2001/04/xmlenc#tripledes-cbc", "http://www.w3.org/2001/04/xmlenc#aes128-cbc" or  "http://www.w3.org/2001/04/xmlenc#aes256-cbc"
                  </p><p class="statement"><span class="statement-id"><a name="R5621">R5621</a></span> 
                    Any xenc:EncryptedKey/xenc:EncryptionMethod/@Algorithm attribute in a SECURE_ENVELOPE MUST have a value of "http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p", "http://www.w3.org/2001/04/xmlenc#kw-tripledes", "http://www.w3.org/2001/04/xmlenc#kw-aes128" or "http://www.w3.org/2001/04/xmlenc#kw-aes256"
                  </p></div><h3><a name="xmlEncryptionConsiderations">9.4</a> Security Considerations</h3><div class="refinement"><h4 id="XSLTrefinement120125134121121120">9.4.1 Encrypt DigestValue</h4><p class="statement"><span class="statement-id"><a name="C5630">C5630</a></span> 
                        A ds:DigestValue in a SECURE_ENVELOPE computed over data that is subsequently
                        encrypted SHOULD also be encrypted in order to prevent plaintext guessing attacks
                        when the probable set of data values is small.  
                    </p></div><h2><a name="algorithms">10. </a>Algorithms</h2><p>This section provides guidance, and in some cases requirements, concerning the use of various categories of algorithms.</p><h3><a name="tlssslalg">10.1</a> Transport Level Security Algorithms</h3><p>In SSL and TLS, choices of algorithms are expressed as ciphersuites.  The following subsections specify ciphersuites that are required, recommended, discouraged and prohibited, respectively.  The use of any other ciphersuite not discussed below is optional.</p><div class="refinement"><h4 id="XSLTrefinement121121136121121120">10.1.1 Mandatory ciphersuites</h4><p class="statement"><span class="statement-id"><a name="R5701">R5701</a></span> 
				A TLS-capable INSTANCE that is not FIPS compliant MUST support TLS_RSA_WITH_3DES_EDE_CBC_SHA
			  </p><p class="statement"><span class="statement-id"><a name="R5702">R5702</a></span> 
				A SSL-capable INSTANCE that is not FIPS compliant MUST support SSL_RSA_WITH_3DES_EDE_CBC_SHA
			  </p><p class="statement"><span class="statement-id"><a name="R5703">R5703</a></span> 
				A TLS-capable INSTANCE that is FIPS compliant MUST support TLS_RSA_FIPS_WITH_3DES_EDE_CBC_SHA
			  </p><p class="statement"><span class="statement-id"><a name="R5704">R5704</a></span> 
				A SSL-capable INSTANCE that is FIPS compliant MUST support SSL_RSA_FIPS_WITH_3DES_EDE_CBC_SHA
			  </p></div><div class="refinement"><h4 id="XSLTrefinement122121136121121120">10.1.2 Recommended ciphersuites</h4><div class="rationale"><p>As the AES encryption algorithm is intended to supercede the 3DES algorithm, it is recommended that TLS-capable implementations implement TLS_RSA_WITH_AES_128_CBC_SHA or the FIPS equivalent, and SSL-capable implementations implement SSL_RSA_WITH_AES_128_CBC_SHA or the FIPS equivalent.</p></div></div><div class="refinement"><h4 id="XSLTrefinement123121136121121120">10.1.3 Discouraged ciphersuites</h4><div class="rationale"><p>The ciphersuites defined in the SSL and TLS specifications that use anonymous Diffie-Helman ( i.e. those that have DH_anon in their symbolic name ) are vulnerable to man-in-the-middle attacks. It is recommended that such ciphersuites be avoided.</p><p>This profile recommends against the use of the following ciphersuites due to their lack of confidentiatlity services:</p><ul><li>SSL_RSA_WITH_NULL_SHA</li><li>TLS_RSA_WITH_NULL_SHA</li><li>SSL_RSA_WITH_NULL_MD5</li><li>TLS_RSA_WITH_NULL_MD5</li></ul><p>It is also recommended that ciphersuites that use 40 or 56 bit keys be avoided, due to their relative ease of compromise through brute-force attack.</p></div></div><div class="refinement"><h4 id="XSLTrefinement124121136121121120">10.1.4 Prohibited ciphersuites</h4><div class="rationale"><p>This profile does not prohibit the use of any transport layer security ciphersuites, but careful thought should be given prior to the use of any ciphersuites discussed under "Discouraged ciphersuites". </p></div></div><h2><a name="reltoBasicProfile">11. </a>Relationship of Basic Security Extension Profile to Basic Profile</h2><p>The Basic Security Profile is an extension profile to the Basic Profile. This means it is consistent with the Basic Profile but profiles additional functionality - how to add conformant security features to the basic profile when needed.</p><p>The Basic Security Profile is an extension of the Basic Profile, designed to support the addition of security functionality to SOAP messaging, in an interoperable manner. One example of such functionality is the confidentiality of selected SOAP header blocks and SOAP body elements through the use of OASIS Web Services Security encryption. The intent of such techniques is to change the nature of the SOAP message so that unintended parties cannot read such content. This means that the secured SOAP message is no longer obviously related to the original WSDL description, and is not intelligible without decryption. Other security mechanisms such as signatures may also modify the content of SOAP envelopes.</p><p>The Basic Profile includes requirements on the content of SOAP envelopes (or in BP 1.0 the format of SOAP messages).  Testing conformance to these statements by using a "man-in-the-middle" interceptor as outlined in the WS-I Monitor Tool Functional Specification will not be possible if encryption has been applied to portions of the SOAP envelope and have not yet been decrypted. Even if interception is possible, some messages may have a different structure due to security.</p><p>Such SOAP messages still conform to the Basic Profile, since conformance to the Basic Profile means conformance once a receiver has reversed security changes introduced by a message sender.  This is not obvious in some Basic Profile requirements, so this document further clarifies these requirements in the normative "Basic Profile Clarifications" section below.</p><p>It is helpful to visualize a SOAP message in light of a protocol layering model, such as the ISO seven layer protocol model [ Tanenbaum ]. This model shows how a protocol is in fact composed of different layers, and how to a given layer underlying layers are transparent. The implementation of a given protocol layer at an endpoint may be modeled as that implementation consuming a service of the underlying protocol layer, and providing a service to the layer above it. In this model no protocol layer need be aware of layers above or below it, making the layer implementations independent. This is illustrated in Figure 1. </p><p><img src="soapstack-2004-05-12.png" /></p><p> Figure 1: Protocol Stack with SOAP Message Security</p><p>Traditionally, protocol layers have been distinguished by the use of protocol enveloping, where the message at one layer is conveyed as the body in the next lower layer. The sender passes a message to the lower level protocol implementation that packages it in a protocol envelope and sends it to the corresponding layer in the receiver. The sender and receiver at this lower layer perform whatever processing is necessary for delivery according to the specification of that layer, and finally the receiver passes the message up to the peer of the sender.</p><p>SOAP Security may be viewed as a lower layer with respect to the more general SOAP web services application layer. Thus a SOAP sender may pass a SOAP message to a lower layer SOAP security implementation that applies encryption (for example), and sends the message to the destination SOAP Security layer, which removes the encryption before passing the message up to the peer SOAP web services application layer.</p><p>Thus a Basic Profile interceptor and compliance monitoring activity should logically occur at a receiver at the interface between the SOAP security implementation and SOAP web services application layer.</p><h3><a name="bpclarify">11.1</a> Basic Profile Clarifications</h3><p>This section clarifies the BP 1.0 and BP 1.1 statements that might be unclear when SOAP Message Security is applied in compliance with the Basic Security Profile.</p><p>This section lists each possibly confusing BP1.0 and BP1.1 requirement and an associated statement to clarify that requirement in the context of the basic security profile.</p><p>When these clarifying statements include the phrase "reverse SOAP Message Security" it means to remove various impacts of applying SOAP Message Security that may have been applied since the MESSAGE (BP1.0) or ENVELOPE (BP 1.1) was originally created for that recipient according to the BP. This may mean decrypting relevant portions of the XML or removing XML Signature elements or making other reverse transformations as appropriate to the aspects of SOAP Message Security that were applied in the specific circumstance. </p><p>Not all security must be reversed, only that for the intended recipient, as applied to the BP compliant envelope before sent to that recipient.</p><div class="refinement"><h4 id="XSLTrefinement121121138121121120">11.1.1 BP Requirement R2301</h4><div class="rationale"><p>bp10:R2301 states "The order of the elements in the soap:body of a MESSAGE  MUST be the same as that of the wsdl:parts in the  wsdl:message that describes it."</p><p>bp11:R2301 states "The order of the elements in the soap:body of an ENVELOPE MUST be the same as that of the wsdl:parts in the wsdl:message that describes it."</p></div><p class="statement"><span class="statement-id"><a name="R5800">R5800</a></span> 
                bp10:R2301 MUST be true after any SOAP Message Security has been reversed for the MESSAGE
              </p><p class="statement"><span class="statement-id"><a name="R5801">R5801</a></span> 
                bp11:R2301 MUST be true after any SOAP Message Security has been reversed for the ENVELOPE
              </p></div><div class="refinement"><h4 id="XSLTrefinement122121138121121120">11.1.2 BP Requirement R2710</h4><div class="rationale"><p>bp10:R2710 states "The operations in a wsdl:binding in a DESCRIPTION MUST result in wire signatures that are different from one another."</p><p>bp11:R2710 states "The operations in a wsdl:binding in a DESCRIPTION MUST result in wire signatures that are different from one another."</p></div><p class="statement"><span class="statement-id"><a name="R5802">R5802</a></span> 
                bp10:R2710 MUST be true after SOAP Message Security processing has been reversed
              </p><p class="statement"><span class="statement-id"><a name="R5803">R5803</a></span> 
                bp11:R2710 MUST be true after SOAP Message Security processing has been reversed
              </p></div><div class="refinement"><h4 id="XSLTrefinement123121138121121120">11.1.3 BP Requirement R2712</h4><div class="rationale"><p>bp10:R2712 states "A document-literal binding MUST be represented on the wire as a MESSAGE with a  soap:Body whose child element is an instance of the global element declaration referenced by the corresponding wsdl:message part."
                </p><p>bp11:R2712 states "A document-literal binding MUST be represented as an ENVELOPE with a soap:Body whose child element is an instance of the global element declaration referenced by the corresponding wsdl:message part."
                </p></div><p class="statement"><span class="statement-id"><a name="R5804">R5804</a></span> 
                bp10:R2712 MUST be true after any SOAP Message Security has been reversed for the MESSAGE
              </p><p class="statement"><span class="statement-id"><a name="R5805">R5805</a></span> 
                bp11:R2712 MUST be true after any SOAP Message Security has been reversed for the ENVELOPE
              </p></div><div class="refinement"><h4 id="XSLTrefinement124121138121121120">11.1.4 BP Requirement R2724</h4><div class="rationale"><p>
                  bp10:R2724 states "If an INSTANCE receives a message that is inconsistent with its WSDL description, it SHOULD generate a soap:Fault with a faultcode of 'Client', unless a 'MustUnderstand' or 'VersionMismatch' fault is generated."
                </p><p>
                  bp11:R2724 states "If an INSTANCE receives an envelope that is inconsistent with its WSDL description, it SHOULD generate a soap:Fault with a faultcode of 'Client', unless a 'MustUnderstand' or 'VersionMismatch' fault is generated."
                </p></div><p class="statement"><span class="statement-id"><a name="R5806">R5806</a></span> 
                For bp10:R2724 "Inconsistent" MUST be taken to mean "Inconsistent after SOAP Message security has been reversed", for the MESSAGE
              </p><p class="statement"><span class="statement-id"><a name="R5807">R5807</a></span> 
                For bp11:R2724 "Inconsistent" MUST be taken to mean "Inconsistent after SOAP Message security has been reversed", for the ENVELOPE
              </p></div><div class="refinement"><h4 id="XSLTrefinement125121138121121120">11.1.5 BP Requirement R2725</h4><div class="rationale"><p>
                  bp10:R2725 states "If an INSTANCE receives a message that is inconsistent with its WSDL description, it MUST check for  "VersionMismatch", "MustUnderstand" and "Client" fault conditions in that order."
                </p><p>
                  bp11:R2725 states "If an INSTANCE receives an envelope that is inconsistent with its WSDL description, it MUST check for "VersionMismatch", "MustUnderstand" and "Client" fault conditions in that order."
                </p></div><p class="statement"><span class="statement-id"><a name="R5808">R5808</a></span> 
                With respect to bp10:R2725 the INSTANCE must check for consistency of the MESSAGE per BP 1.0 after reversing SOAP Message Security.
              </p><p class="statement"><span class="statement-id"><a name="R5809">R5809</a></span> 
                With respect to bp11:R2725 the INSTANCE must check for consistency of the ENVELOPE per BP 1.1 after reversing SOAP Message Security.
              </p></div><div class="refinement"><h4 id="XSLTrefinement126121138121121120">11.1.6 BP Requirement R2729</h4><div class="rationale"><p>bp10:R2729 states "A MESSAGE described with an rpc-literal binding that is a response message MUST have a wrapper element whose name is the corresponding wsdl:operation name suffixed with the string 'Response'."
                </p><p>bp11:R2729 states "An ENVELOPE described with an rpc-literal binding that is a response MUST have a wrapper element whose name is the corresponding wsdl:operation name suffixed with the string 'Response'."
                </p></div><p class="statement"><span class="statement-id"><a name="R5810">R5810</a></span> 
                With respect to bp10:R2729 the verification of the wrapper element name of the MESSAGE must be performed after reversing SOAP Message Security.
              </p><p class="statement"><span class="statement-id"><a name="R5811">R5811</a></span> 
                With respect to bp11:R2729 the verification of the wrapper element name of the ENVELOPE must be performed after reversing SOAP Message Security.
              </p></div><div class="refinement"><h4 id="XSLTrefinement127121138121121120">11.1.7 BP Requirement R2738</h4><div class="rationale"><p>bp10:R2738 states "A MESSAGE MUST include all soapbind:headers specified on a wsdl:input or wsdl:output of a wsdl:operation of a  wsdl:binding that describes it.</p><p>bp11:R2738 states "An ENVELOPE MUST include all soapbind:headers specified on a wsdl:input or wsdl:output of a wsdl:operation of a wsdl:binding that describes it."</p></div><p class="statement"><span class="statement-id"><a name="R5812">R5812</a></span> 
                With respect to bp10:R2738 verification of a MESSAGE must occur have SOAP Message Security has been reversed.
              </p><p class="statement"><span class="statement-id"><a name="R5813">R5813</a></span> 
                With respect to bp11:R2738 verification of an ENVELOPE must occur have SOAP Message Security has been reversed.
              </p></div><h2><a name="attachsec">12. </a>Attachment Security</h2><p>
		       The section provides guidance for protecting attachments when they are used with SOAP Messages.
		       As is explained in Section 3 Conformance all features described in this Profile, including support
		       for attachments and security for attachments in any form by any instance is not required.
          </p><p>
             SSL/TLS may be used to provide authentication, integrity and confidentiality protection, on a
             hop-by-hop basis, for an entire HTTP Message. This includes HTTP Headers, the SOAP Envelope, and
             all MIME Parts including MIME Headers.
          </p><p>
             SSL/TLS does not provide protection, except between adjacent HTTP Nodes, for HTTP Messages when
             the SOAP Message Path contains SOAP Intermediaries. An instance should not use SSL/TLS without
             WSS with MEPs that may contain SOAP intermediaries or when these security functions are required
             to be performed independently of the connection.
          </p><p>
             WSS may be used to provide authentication, integrity and confidentiality protection for a subset
             of the SOAP Message and associated attachments.WSS provides protection for SOAP Messages and
             attachments when the SOAP Message Path contains SOAP Intermediaries. An instance should use WSS
             with MEPs that may contain SOAP Intermediaries or when these security functions are required to
             be performed independently of the transport layer connection.
          </p><p>
             If it is required for an instance to integrity and confidentiality protect the entire HTTP Message,
             on a hop-by-hop basis, including HTTP Headers, SOAP Envelope, and all MIME Parts including MIME
             Headers, SSL/TLS may be used in conjunction with WSS.
          </p><p>
             Application level security mechanisms, including XML Signature, XML Encryption, PKCS7, S/MIME, etc.
             for attachment data may also be used by a instance where appropriate, but statements regarding the
             interoperability of such mechanisms are out of scope for this Profile.
          </p><p>
             Attachment security conformance claim URIs (as defined in 12.1) constitute an extensibility point
             of the Basic Security Profile. Profiles for other mechanisms for dealing with attachments and attachment security
             MUST define a URI for claiming conformance.
          </p><p>
             This Profile describes one attachment security mechanism and URI.
          </p><h3><a name="swa">12.1</a> SOAP with Attachments</h3><p>The following specifications (or sections thereof) are referred to
		in this section of the Profile;</p><ul><li><a href="http://www.ws-i.org/Profiles/Basic/2003-08/AttachmentsProfile-1.0.pdf">Attachment Profile 1.0</a></li></ul><div class="refinement"><h4 id="XSLTrefinement121121140121121120">12.1.1 Conformance</h4><p class="statement"><span class="statement-id"><a name="R6000">R6000</a></span> 
                 Conformance to this section of the profile MUST be indicated by a SENDER or RECEIVER by placing a
                 ConformanceClaim element on the wsdl:port or wsdl:binding (per BP 1.0 Section 3.3) in the WSDL
                 description of the service with the following URI: http://ws-i.org/profiles/basic-security/swa/1.0.
              </p><p class="statement"><span class="statement-id"><a name="R6001">R6001</a></span> 
                 The SECURE_MESSAGE MUST conform to Attachments Profile 1.0.
              </p></div><div class="refinement"><h4 id="XSLTrefinement122121140121121120">12.1.2 Scope</h4><p class="statement"><span class="statement-id"><a name="R6002">R6002</a></span> 
                 A MIME Part that is signed and/or encrypted using WSS MUST be at the same MIME level as the root
                 MIME Part containing the SECURE_ENVELOPE.
              </p></div><h3><a name="signedAttachments">12.2</a> Signed Attachments</h3><div class="refinement"><h4 id="XSLTrefinement120122140121121120">12.2.1 Reference</h4><p class="statement"><span class="statement-id"><a name="R6100">R6100</a></span> 
                 A MIME Part signed using WSS MUST be referenced from within the SECURE_ENVELOPE using a
                 wsse:Security/ds:Reference element with a URI attribute of the "cid:partToBeSigned".
              </p></div><div class="refinement"><h4 id="XSLTrefinement121122140121121120">12.2.2 Transform</h4><p class="statement"><span class="statement-id"><a name="R6101">R6101</a></span> 
                 A ds:Reference within a SECURE_ENVELOPE to a signed MIME Part signed using WSS MUST use a MIME Part Signature Transform
                 designated by the URI [TBD]. This MIME Part Signature Transform and URI will be specified before
                 the final version of this Profile is released. The anticipated venue to define this Transform is
                 the OASIS WSS TC.
              </p></div><div class="refinement"><h4 id="XSLTrefinement122122140121121120">12.2.3 Encoding</h4><p class="statement"><span class="statement-id"><a name="R6103">R6103</a></span> 
                 A MIME Part signed using WSS MUST have a Content-Transfer-Encoding of binary in effect at the time
                 of WSS processing at both the SENDER and RECEIVER. This does not preclude use of another form of
                 Content-Transfer-Encoding after a message is signed as long as it is removed before the message is
                 verified.
              </p></div><h3><a name="encryptedAttachments">12.3</a> Encrypted Attachments</h3><div class="refinement"><h4 id="XSLTrefinement120123140121121120">12.3.1 Reference</h4><p class="statement"><span class="statement-id"><a name="R6200">R6200</a></span> 
                 When a MIME Part is encrypted using WSS, the SECURE_ENVELOPE MUST contain an xenc:DataReference
                 which points to the wsse:Security/../xenc:EncryptedData associated with the encrypted MIME Part.
              </p><p class="statement"><span class="statement-id"><a name="R6201">R6201</a></span> 
                 A MIME Part encrypted using WSS MUST be referenced from within the SECURE_ENVELOPE using a
                 wsse:Security/.../xenc:EncryptedData element with a Type attribute with the value
                 "http://www.w3.org/2001/04/xmlenc#Content".
		        </p><p class="statement"><span class="statement-id"><a name="R6202">R6202</a></span> 
		           Within a SECURE_ENVELOPE the wsse:Security/.../xenc:EncryptedData element that references a
		           MIME Part encrypted using WSS MUST contain a xenc:CipherData/xenc:CipherReference element with
		           a URI attribute of the form "cid:partToBeEncrypted".
		        </p></div><div class="refinement"><h4 id="XSLTrefinement121123140121121120">12.3.2 Content</h4><p class="statement"><span class="statement-id"><a name="R6203">R6203</a></span> 
                 The content of an MIME Part in a SECURE_MESSAGE encrypted using WSS MUST be replaced by the
                 result of encrypting the content of the MIME Part.
              </p><p class="statement"><span class="statement-id"><a name="R6204">R6204</a></span> 
                 The content, including MIME Headers and Body, of a decrypted MIME Part in a SECURE_MESSAGE MUST be replaced by the
                 result of decrypting the content of the MIME Part.
              </p><p class="statement"><span class="statement-id"><a name="R6205">R6205</a></span> 
                 The value of the Content-ID MIME Header of a MIME Part encrypted in a SECURE_MESSAGE using WSS MUST match the value
                 of the Content-ID MIME Header of the MIME Part before it was encrypted.
              </p></div><div class="refinement"><h4 id="XSLTrefinement122123140121121120">12.3.3 Transform</h4><p class="statement"><span class="statement-id"><a name="R6206">R6206</a></span> 
                 When encrypting a MIME Part using WSS a SENDER MUST use a MIME Part Encryption Transform
                 designated by the URI [TBD]. This MIME Part Encryption Transform and URI will be specified
                 before the final version of this Profile is released. The anticipated venue to define this
                 Transform is the OASIS WSS TC.
              </p><p class="statement"><span class="statement-id"><a name="R6207">R6207</a></span>                 
                 When a MIME Part is encrypted using WSS, the SECURE_ENVELOPE MUST contain an xenc:DataReference
                 that includes a ds:Transform element which references a MIME Part Decryption Transform designated
                 by the URI [TBD]. This MIME Part Decryption Transform and URI will be specified before the final
                 version of this Profile is released. The anticipated venue to define this Transform is the OASIS
                 WSS TC.
              </p></div><h2><a name="seccon">13. </a>Security Considerations</h2><p>This section lists a number of security considerations that should be taken into account when using one or more of the technologies discussed in this profile.</p><dl><dt>SOAPAction Header</dt><dd>The use of the SOAPAction header in situations where the message content is being integrity or confidentiality protected can result in security risks when the transport layer does not provide the same protection to the SOAPAction header. The most obvious risk is that the SOAPAction header can potentially expose sensitive information about a SOAP message such as the URI of the service, or the context of the transaction that is taking place. Another, more subtle risk    occurs in a situation where message    routing is done based on the value of the SOAPAction header. By    modifying the value, an attacker could cause the message to be directed to a different receiver. This could potentially defeat a replay detection mechanism that was based on the assumption that the message would always be routed to the same place. There is also the additional risk where some processing is performed by an intermediary based on the SOAPAction value. Changing    the value of the SOAPAction may cause incorrect processing by the intermediary. This is especially important when the intermediary is performing security processing.</dd><dt>Clock Synchronization</dt><dd>The specifications covered by this profile use time-based mechanisms to prevent replay attacks. These mechanisms will be ineffective unless the system clocks of the various network nodes are synchronized. Since the technology to perform distributed clock synchronization are well known and widely available and are not among the technologies being profiled here, this document does not specify how clock synchronization should be done. However, the recommendation of the use of time-based security mechanisms implies that synchronization is being done.</dd><dt>Key Identifiers and Token Substitution</dt><dd>If a message is signed using a Security Token that binds a public verification key with other claims, and specific processing is performed based on those claims, then in order to protect against post-signature substitution of the Security Token with one that binds the same key to different claims, Security Token itself should be part of the signature computation. This can be acheived by putting a child ds:Reference element whose URI attribute contains a shorthand XPointer reference to the wsse:SecurityTokenReference that specifies the Security Token into the ds:SignedInfo element of a signature.</dd><dt>Binding Security Tokens to Signatures</dt><dd>If a ds:SignedInfo contains one or more ds:Reference children whose URI attribute contains a shorthand XPointer reference to a wsse:SecurityTokenReference that uses a potentially ambiguous mechanism to refer to the Security Token (e.g. KeyIdentifier), then in order to protect against post-signature substitution of the Security Token with one that binds the same key to different claims, it is recommended that at least one ds:Reference use the wsse:SecurityTokenReference deferencing transform. Other references to the wsse:SecurityTokenReference that do not use the wsse:SecurityTokenReference dereferencing transform may also appear. </dd><dt>Uniqueness of ID attributes</dt><dd>XML 1.0 requires that all attributes of type ID in a given XML document have unique values, but only validating XML processors have such type information. As various aspects of SOAP Message Security use ID based references it is recommended that applications ensure that ID attributes are unique by some mechanism.</dd><dt>Encryption Key Substitution</dt><dd>When a key is provided in band within a Token or otherwise for the purpose of specifying a key to be used by another node for encrypting information to be sent in a future message, it is recommended that the sender of the key cryptographicaly bind the key to the message in which it is transmitted. This can be done either by using the key to perform a Signature or HMAC over critical elements of the message body or by including the key under a signature covering critical elements of the message body which uses some other key. If a key is sent in a message which the receiver is expected to use to encrypt data in some future message, there is a risk that an attacker could substitute some other key and thereby be able to read unauthorized data. This is true even if the key is contained in a signed certificate, but is not bound to the current message in some way. If the future encryption key is used to sign the initial request, by verifying the signature, the receiver can determine that the key is the one that was intended. </dd><dt>Signing Security Tokens</dt><dd>In general, tokens contain claims made by an authority, usually about some system entity. Obviously a party relying on these claims must trust that authority to make them. The relying party must generally verify these claims. The method of doing this depends on the token type and is specified by the corresponding token profile.</dd><dt>Signing Username Tokens</dt><dd>When the Token contains only a Username and Password and is simply presented for Authentication,
                    it does not need to be signed because the act of checking it against a stored value has the effect of verifying it.
                    When a nonce and/or timestamp are used with the Username and Password to prevent replay,
                    the Token must be signed to prevent undetected alteration of these fields.
                    If a Password is being used to derive a key for a subsequent encryption of a response,
                    it should be signed to ensure that an attacker doesn not substitute an alternative,
                    but valid Username and Password.
                    This is equivalent to the key substitution attack available when an X.509 Token is used for a similiar purpose.</dd><dt>Signing Binary Tokens</dt><dd>The content of a binary token will be a binary object which is integrity protected by a mechanism specific to the object type. For example, an X.509 certificate will be signed by the issuing authority. The outer wrapper of the binary token merely contains type indication information which does not have to be integrity protected in order to be able to rely in the claims.</dd><dt>Signing XML Tokens</dt><dd>XML tokens should be digitally signed in a manner described by their profile (or documents referenced by it), or delivered directly from their issuer over an integrity protected channel.</dd><dt>Replay of Username Token</dt><dd>A sender that includes a Nonce child in a UsernameToken element should anticipate that the receiver may refuse to process the message due to either an accidental collision or transport layer delays. Therefore, if it decides to retry transmission, it should do so with a new Nonce.</dd><dd>Unless other mechanisms are used to protect against replay of the username token, service providers should retain nonces in a store that is shared between all SOAP nodes (and within a distributed SOAP node all "components") that can be authorized using the same passwords.</dd><dd>The policy that allows service providers to forget nonces may be based on any considerations that the service considers relevant. When a nonce is forgotten the server should ensure that in the future it rejects UsernameTokens with a Created time that is earlier than the forgotten nonce.</dd><dt>Use of password digests vs cleartext password</dt><dd>A sending application utilizing password authentication must decide whether to use a cleartext password or a password digest (The sender needs to know via some out-of-band mechanism and/or prior arrangement which mechanisms the receiver supports). The digest should always be prefered if it can be used, as the digest algorithm does not reveal the password and can protect against replay of the password. (It does not however, protect against offline guessing or brute force attacks.)</dd><dd>Password digests can only be used in situations where both sender and receiver can start with the same secret value (e.g., the cleartext password or a hash of the password). The following are criteria for considering when to use digests vs. cleartext:</dd><dd>1. If the receiver can access the cleartext password, a digest may be used. </dd><dd>2. If the receiver can access a value that can be derived by the sender directly from the cleartext password (e.g., the receiver has access to a SHA1 hash of the password), the derived value (e.g. the hash) may be used in the digest. </dd><dd>3. If the sender needs extra information to derive the value available to the receiver, it will not be feasible to use password digest, even though the information is not intentionally secret. For example, UNIX systems add a salt value to each password before hashing it. It is infeasible for the sender to discover the salt value required for a specific username.</dd><dd>4. If the receiver does not have access to any password value, derived or otherwise, but merely the ability to test a username/password combination for validity, a digest may not be used. An example of this is when the username/password combination is presented to a database, directory or mainframe system for verification.</dd><dd>When sending any form of a password, cleartext or digest, confidentiality services are strongly recommended to prevent its value from being revealed or from offline guessing.</dd><dt>Encryption with signature</dt><dd>When a message contains a data value which does not has a significant number of probable variations and that data is signed and then encrypted, it is recommended that the sender either include some suitably random value such as a wsse:Nonce in the data, or encrypt the related ds:DigestValue element in order to protect the confidentiality of the data.</dd><dd>An adversary can compute the digest for each data values and compare them against the digests in the signature thereby deducing the encrypted data value. This type of attack is most likely to be successful when there are a relatively small set of probable data values. Therefore the threat can be mitigated by introduction of some random value into the original data or encryption of the digest.</dd></dl><h2 id="references">Appendix I: Referenced Specifications</h2><p>The following specifications' requirements are incorporated into the Profile by reference, except where superseded by the Profile:</p><ul><li><a href="http://www.ietf.org/rfc/rfc2818.txt">HTTP over TLS</a></li><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security</a></li><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0.pdf">Web Services Security: Username Token Profile</a></li><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0.pdf">Web Services Security: X.509 Token Profile</a></li><li><a href="http://www.w3.org/TR/xmldsig-core/">XML-Signature Syntax and Processing</a></li><li><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security Section 9</a></li><li><a href="http://www.w3.org/TR/xmlenc-core/">XML Encryption Syntax and Processing</a></li></ul><h2 id="points">Appendix II: Extensibility Points</h2><p>This section identifies extensibility points, as defined in "Scope of the Profile," for the Profile's component specifications.</p><p>These mechanisms are out of the scope of the Profile; their use may affect interoperability, and may require private agreement
		between the parties to a Web service.</p><p>In <a href="http://www.ietf.org/rfc/rfc2818.txt">HTTP over TLS:</a></p><ul><li><span class="statement-id">E0001</span> - <strong>Ciphersuites</strong> - Additional ciphersuites may be specified.</li></ul><p>In <a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security:</a></p><ul><li><span class="statement-id">E0002</span> - <strong>Security Tokens</strong> - Security tokens may be specified in additional security token profiles.</li></ul><p>In <a href="http://www.w3.org/TR/xmldsig-core/">XML-Signature Syntax and Processing:</a></p><ul><li><span class="statement-id">E0003</span> - <strong>CanonicalizationMethod Algorithm</strong> - Additional canonicalization algorithms may be specified.</li><li><span class="statement-id">E0004</span> - <strong>Transform Algorithm</strong> - Additional transform algorithms may be specified.</li><li><span class="statement-id">E0005</span> - <strong>DigestMethod Algorithm</strong> - Additional digest algorithms may be specified.</li><li><span class="statement-id">E0006</span> - <strong>SignatureMethod Algorithm</strong> - Additional signature algorithms may be specified.</li><li><span class="statement-id">E0007</span> - <strong>RetrievalMethod</strong> - Additional retrieval methods may be specified.</li></ul><p>In <a href="http://www.w3.org/TR/xmlenc-core/">XML Encryption Syntax and Processing:</a></p><ul><li><span class="statement-id">E0008</span> - <strong>Encryption Algorithm</strong> - Additional encryption algorithms may be specified.</li></ul><h2 id="acks">Appendix III: Acknowledgements</h2><p>This Profile is the work of the WS-I Basic Security Profiles Working Group, whose 
		members have included:</p><p>
        Steve Anderson (OpenNetwork),
        Paula Austel (IBM),
		  Siddharth Bajaj (Verisign),
        Abbie Barbir (Nortel Networks),
		  David Baum (Kantega AS),
		  Randy Bias (Grand Central Communications),
		  Tim Bond (webMethods Inc.),
		  Heidi Buelow (Quovadx),
		  David Burdett (Commerce One, Inc.),
		  Ted Burghart (Hitachi, Ltd.)
		  Symon Chang (Commerce One, Inc.),
		  Dipak Chopra (SAP AG),
		  Jamie Clark (OASIS),
		  Edward Cobb (BEA Systems Inc.),
		  David Cohen (Merrill Lynch),
		  Ugo Corda (SeeBeyond Technology),
        Paul Cotton (Microsoft Corporation),
        Mark Davis (Sarvega Inc.),
        Alex Deacon (Verisign),
        Blake Dournaee (Sarvega Inc.),
		  Rob Drew (Charlse Schwab),
		  Gregory Elkins (Reed Elsevier),
		  Mark Ericson (Mindreef),
		  Jon Oyvind Eriksen (Kantega AS),
		  Chris Ferris (IBM),
        Edwin Goei (Sun Microsystems),
		  Grant Goodale (Reactivity Inc.),
		  Marc Goodner (SAP AG),
		  Phil Goodwin (Sun Microsystems),
		  Marc Graveline (Cognos, Inc.),
		  Eric Gravengaard (Reactivity Inc.),
		  Thomas Gross (IBM),
        Martin Gudgin (Microsoft Corporation),
        Marc Hadley (Sun Microsystems),
		  Mark Hapner (Sun Microsystems),
		  Nathan Harris (Kaiser Permanente),
        Bret Hartman (Datapower Technology, Inc.),
        Frederick Hirsch (Nokia),
		  Jason Hogg (Microsoft Corporation),
		  Maryann Hondo (IBM),
		  Lawrence Hsiung (Quovadx),
		  Tony Huber (Commerce Quest),
		  Jim Hughes (Hewlett-Packard),
		  Michael Hui (Computer Associates),
		  Brian Jackson (Avanade Inc.),
		  Steve Jenisch (SAS Institute),
		  Erik Johnson (Epicor),
        Chris Kaler (Microsoft Corporation),
		  Anish Karmarkar (Oracle Corporation),
		  Manveen Kaur (Sun Microsystems),
		  Slava Kavsan (RSA Security),
		  Paul Knight (Nortel Networks),
		  Chris Kurt (Microsoft Corporation),
		  Kelvin Lawrence (IBM),
        Hal Lockhart (BEA Systems),
		  Brad Lund (Intel Corporation),
		  Jim Luth (OPC Foundation),
		  Paul Madsen (Entrust Inc.),
        Eve Maler (Sun Microsystems),
		  Skip Marler (Parasoft),
		  Axl Mattheus (Sun Microsystems),
        Michael McIntosh (IBM),
		  Chris Miller (Accenture),
		  Dale Moberg (Cyclone Commerce),
		  Ron Monzillo (Sun Microsystems),
		  Tim Moses (Entrust Inc.),
        Tony Nadalin (IBM),
		  Nataraj Nagaratnam (IBM),
        Andrew Nash (RSA Security),
		  Hsin Ning (Bestning Technologies),
		  Eisaku Nishiyama (Hitachi, Ltd.),
		  Mark Nottingham (BEA Systems Inc.),
		  TJ Pannu (ContentGuard Inc.),
		  Martine Pean (Quovadx),
		  Robert Philpott (RSA Security),
		  Dave Prout (BT),
		  Joe Pruitt (F5 Networks Inc.),
		  Eric Rejkovic (Oracle Corporation),
		  Matt Cecupito (Accenture),
		  Jason Rouault (Hewlett-Packard),
        Rich Salz (Datapower Technology Inc.),
		  Matt Sanchez (Webify Solutions Inc. ),
        Jerry Schwarz (Oracle Corporation),
		  Senthil Sengodan (Nokia),
		  Shawn Sharp (Cyclone Commerce),
		  Aslak Siira (F5 Networks Inc.),
		  David Solo (Citigroup, Inc. ),
		  Davamun Srinivas (Computer Associates),
		  Raghavan Srinivas (Sun Microsystems),
		  John Stanton (Defense Information Systems Agency),
        Andrew Stone (Accenture),
		  Julie Surer (MITRE),
		  Wes Swenson (Forum Systems),
		  Dino Vitale (Citigroup, Inc.),
		  Jonathan Wenocur (Datapower Technology, Inc.),
		  Pete Wenzel (SeeBeyond Technology),
		  Ian White (Micro Focus)
        </p></body>
</html>